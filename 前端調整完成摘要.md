# å‰ç«¯èª¿æ•´å®Œæˆæ‘˜è¦

**å®Œæˆæ—¥æœŸ**: 2025å¹´10æœˆ22æ—¥  
**ç‹€æ…‹**: âœ… **æ‰€æœ‰èª¿æ•´å®Œæˆï¼Œæº–å‚™é–‹å§‹æ•´åˆæ¸¬è©¦**

---

## ğŸ“Š èª¿æ•´æ¦‚è¦½

æ ¹æ“šå¾Œç«¯æ¸¬è©¦å ±å‘Šï¼ˆ25/26é€šéï¼Œ96.2%ï¼‰ï¼Œå‰ç«¯å·²å®Œæˆæ‰€æœ‰å¿…è¦çš„èª¿æ•´ã€‚

---

## âœ… å·²å®Œæˆçš„èª¿æ•´

### 1. é¡å‹å®šç¾©èª¿æ•´

#### 1.1 æŸ¥è©¢åƒæ•¸åç¨±
**æª”æ¡ˆ**: `copy/vue/src/types/prediction.ts`

```diff
export interface PredictionsQueryParams {
-  memberId?: string;
+  userId?: string; // å¾Œç«¯ä½¿ç”¨ userId è€Œé memberId
   allianceId?: number;
   dateRange?: DateRange;
   gameMode?: GameMode;
   status?: PredictionStatus | 'all';
   page?: number;
   size?: number;
}
```

#### 1.2 Prediction ä»‹é¢å®Œå–„
**æª”æ¡ˆ**: `copy/vue/src/types/prediction.ts`

```diff
export interface Prediction {
  id: number;
  userId: number;
  userName: string;
  userAvatarUrl: string;
  gameId: string;
  gameInfo: GameInfo;
  predictionType: PredictionType;
  predictionTypeLabel: string;
- selection: PredictionSelection;
+ selection: PredictionSelection | null; // æœªè³¼è²·æ™‚ç‚º null
- selectionLabel: string;
+ selectionLabel: string; // æœªè³¼è²·æ™‚ç‚º "***"
  odds: string;
  price: number;
  isMainPick: boolean;
- note: string;
+ note: string | null; // æœªè³¼è²·æ™‚ç‚º null
  status: PredictionStatus;
  isPurchased: boolean;
  isOwn: boolean;
+ purchaseCount?: number; // è³¼è²·äººæ•¸ï¼ˆå¾Œç«¯æä¾›ï¼‰
  createdAt: string;
  updatedAt: string;
}
```

**èª¿æ•´èªªæ˜**:
- âœ… `selection` å’Œ `note` æ”¹ç‚ºå¯ç‚º `null`ï¼ˆæœªè³¼è²·æ™‚ï¼‰
- âœ… åŠ å…¥ `purchaseCount` æ¬„ä½ï¼ˆå¾Œç«¯è¿”å›è³¼è²·äººæ•¸ï¼‰

### 2. API èª¿ç”¨èª¿æ•´

#### 2.1 çµ±ä¸€ä½¿ç”¨ getPredictions
**æª”æ¡ˆ**: `copy/vue/src/pages/MemberPage.vue`

**ä¹‹å‰çš„é‚è¼¯**ï¼ˆéŒ¯èª¤ï¼‰:
```typescript
// åˆ†åˆ¥ä½¿ç”¨ getMyPredictions å’Œ getMemberPredictions
if (memberId === session.profile?.id) {
  result = await predictionsAPI.getMyPredictions({...});
} else {
  result = await predictionsAPI.getMemberPredictions(memberId, {...});
}
```

**ç¾åœ¨çš„é‚è¼¯**ï¼ˆæ­£ç¢ºï¼‰:
```typescript
// çµ±ä¸€ä½¿ç”¨ getPredictionsï¼Œå‚³å…¥ userId åƒæ•¸
const result = await predictionsAPI.getPredictions({
  userId: userId,
  page: currentPage.value,
  size: pageSize.value,
});
```

**èª¿æ•´èªªæ˜**:
- âœ… æ ¹æ“šå¾Œç«¯å¯¦ä½œï¼Œçµ±ä¸€ä½¿ç”¨ `GET /predictions?userId=xxx`
- âœ… ç§»é™¤ä¸å­˜åœ¨çš„ `getMyPredictions` å’Œ `getMemberPredictions`
- âœ… ç°¡åŒ–äº†æŸ¥è©¢é‚è¼¯

### 3. å›æ‡‰æ ¼å¼èª¿æ•´

#### 3.1 é æ¸¬åˆ—è¡¨å›æ‡‰
**æª”æ¡ˆ**: `copy/vue/src/pages/MemberPage.vue`

```diff
if (result.success) {
  predictions.value = result.data || [];
- totalPredictions.value = result.total || 0;
+ totalPredictions.value = result.pagination?.total || 0;
}
```

**èª¿æ•´èªªæ˜**:
- âœ… å¾Œç«¯è¿”å› `pagination.total` è€Œéç›´æ¥çš„ `total`
- âœ… èˆ‡å¾Œç«¯æ ¼å¼å®Œå…¨ä¸€è‡´

---

## ğŸ¯ èˆ‡å¾Œç«¯çš„å°æ‡‰é—œä¿‚

### API ç«¯é»å°ç…§

| åŠŸèƒ½ | å‰ç«¯ä»£ç¢¼ | å¾Œç«¯å¯¦ä½œ | ç‹€æ…‹ |
|------|---------|---------|------|
| æŸ¥è©¢å½©å¹£ | `GET /me/coins` | `GET /me/coins` | âœ… ä¸€è‡´ |
| å……å€¼å½©å¹£ | `POST /me/coins/purchase` | `POST /me/coins/purchase` | âœ… ä¸€è‡´ |
| å»ºç«‹é æ¸¬ | `POST /predictions` | `POST /predictions` | âœ… ä¸€è‡´ |
| æŸ¥è©¢é æ¸¬ | `GET /predictions?userId=xxx` | `GET /predictions?userId=xxx` | âœ… ä¸€è‡´ |
| è³¼è²·é æ¸¬ | `POST /predictions/{id}/purchase` | `POST /predictions/{id}/purchase` | âœ… ä¸€è‡´ |
| é æ¸¬è¨­å®š | `GET /me/prediction-settings` | `GET /me/prediction-settings` | âœ… ä¸€è‡´ |
| æ›´æ–°è¨­å®š | `PATCH /me/prediction-settings` | `PATCH /me/prediction-settings` | âœ… ä¸€è‡´ |

### æ¬„ä½åç¨±å°ç…§

| åŠŸèƒ½ | å‰ç«¯æ¬„ä½ | å¾Œç«¯æ¬„ä½ | ç‹€æ…‹ |
|------|---------|---------|------|
| é æ¸¬ ID | `id` | `id` | âœ… ä¸€è‡´ |
| ç”¨æˆ¶ ID | `userId` | `userId` | âœ… ä¸€è‡´ |
| è³¼è²·å¾Œé¤˜é¡ | `remainingCoins` | `remainingCoins` | âœ… ä¸€è‡´ |
| è³¼è²·äººæ•¸ | `purchaseCount` | `purchaseCount` | âœ… å·²åŠ å…¥ |
| é¸æ“‡å…§å®¹ | `selection` (å¯ç‚º null) | `selection` (å¯ç‚º null) | âœ… ä¸€è‡´ |
| é æ¸¬èªªæ˜ | `note` (å¯ç‚º null) | `note` (å¯ç‚º null) | âœ… ä¸€è‡´ |

### å…§å®¹éš±è—é‚è¼¯å°ç…§

| æƒ…æ³ | å‰ç«¯é¡å‹ | å¾Œç«¯è¿”å› | ç‹€æ…‹ |
|------|---------|---------|------|
| æœªè³¼è²· | `selection: null` | `selection: null` | âœ… ä¸€è‡´ |
| æœªè³¼è²· | `note: null` | `note: null` | âœ… ä¸€è‡´ |
| æœªè³¼è²· | `selectionLabel: string` | `selectionLabel: "***"` | âœ… ä¸€è‡´ |
| å·²è³¼è²·/æœ¬äºº | `selection: PredictionSelection` | `selection: "home"` | âœ… ä¸€è‡´ |
| å·²è³¼è²·/æœ¬äºº | `note: string` | `note: "..."` | âœ… ä¸€è‡´ |
| å·²è³¼è²·/æœ¬äºº | `selectionLabel: string` | `selectionLabel: "ä¸» -1.5"` | âœ… ä¸€è‡´ |

---

## ğŸ“ æœªèª¿æ•´çš„éƒ¨åˆ†ï¼ˆå·²ç¢ºèªæ­£ç¢ºï¼‰

### 1. API ç«¯é»ï¼ˆå·²æ­£ç¢ºï¼‰
- âœ… å½©å¹£ APIï¼šå‰ç«¯å·²ä½¿ç”¨ `/me/coins` å’Œ `/me/coins/purchase`
- âœ… é æ¸¬ APIï¼šå‰ç«¯å·²ä½¿ç”¨æ­£ç¢ºçš„ç«¯é»

### 2. æ ¸å¿ƒæ¬„ä½ï¼ˆå·²æ­£ç¢ºï¼‰
- âœ… å‰ç«¯å·²ä½¿ç”¨ `id` è€Œé `predictionId`
- âœ… å‰ç«¯å·²ä½¿ç”¨ `remainingCoins` è€Œé `newBalance`

### 3. éŒ¯èª¤è™•ç†ï¼ˆå·²æ­£ç¢ºï¼‰
- âœ… å‰ç«¯å·²æº–å‚™è™•ç†æ‰€æœ‰éŒ¯èª¤ç¢¼
- âœ… éŒ¯èª¤ç¢¼æ¸…å–®èˆ‡å¾Œç«¯ä¸€è‡´

---

## ğŸ§ª å¾Œç«¯å·²é©—è­‰çš„åŠŸèƒ½

æ ¹æ“šå¾Œç«¯æ¸¬è©¦å ±å‘Šï¼Œä»¥ä¸‹åŠŸèƒ½å·²å®Œå…¨æ¸¬è©¦é€šéï¼š

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆ100%ï¼‰
- âœ… é æ¸¬å»ºç«‹åŠŸèƒ½ï¼ˆè¿”å› predictionIdï¼Œæ‰€æœ‰æª¢æŸ¥æ­£å¸¸ï¼‰
- âœ… å…§å®¹éš±è—é‚è¼¯ï¼ˆæœªè³¼è²·æ™‚éš±è—ï¼Œè³¼è²·å¾Œè§£é–ï¼‰
- âœ… é æ¸¬è³¼è²·åŠŸèƒ½ï¼ˆå½©å¹£æ‰£é™¤ã€è½‰å¸³ã€é˜²è­·æ©Ÿåˆ¶ï¼‰
- âœ… å½©å¹£æµè½‰æ­£ç¢ºï¼ˆè²·å®¶ -100ï¼Œè³£å®¶ +100ï¼‰
- âœ… éŒ¯èª¤é˜²è­·ï¼ˆé‡è¤‡è³¼è²·ã€è‡ªè³¼ã€é¤˜é¡ä¸è¶³ç­‰ï¼‰

### æ¸¬è©¦æ•¸æ“š
**å¯¦éš›æ¸¬è©¦å ´æ™¯**ï¼š
```
ç”¨æˆ¶ Aï¼ˆè³£å®¶ï¼‰:
  - åˆå§‹é¤˜é¡: 2000
  - å»ºç«‹é æ¸¬: åƒ¹æ ¼ 100
  - æœ€çµ‚é¤˜é¡: 2100ï¼ˆ+100ï¼‰âœ“

ç”¨æˆ¶ Bï¼ˆè²·å®¶ï¼‰:
  - åˆå§‹é¤˜é¡: 500
  - è³¼è²·é æ¸¬: èŠ±è²» 100
  - æœ€çµ‚é¤˜é¡: 400ï¼ˆ-100ï¼‰âœ“

å…§å®¹éš±è—:
  - è³¼è²·å‰: selection=null, note=null, selectionLabel="***" âœ“
  - è³¼è²·å¾Œ: å®Œæ•´é¡¯ç¤ºæ‰€æœ‰å…§å®¹ âœ“
```

---

## ğŸ¯ å‰ç«¯å¯ä»¥ç«‹å³é–‹å§‹çš„å·¥ä½œ

### ä»Šå¤©å¯ä»¥åšï¼ˆåŸºç¤åŠŸèƒ½ï¼‰
1. âœ… æ¸¬è©¦ç”¨æˆ¶è¨»å†Šèˆ‡ç™»å…¥
2. âœ… æ¸¬è©¦å½©å¹£æŸ¥è©¢èˆ‡å……å€¼
3. âœ… æ¸¬è©¦é æ¸¬è¨­å®šè®€å–èˆ‡æ›´æ–°
4. âœ… æ¸¬è©¦è³½äº‹åˆ—è¡¨æŸ¥è©¢

### æ˜å¤©å¯ä»¥åšï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… æ¸¬è©¦å»ºç«‹é æ¸¬
2. âœ… æ¸¬è©¦é æ¸¬åˆ—è¡¨æŸ¥è©¢
3. âœ… é©—è­‰å…§å®¹éš±è—é‚è¼¯
4. âœ… æ¸¬è©¦éŒ¯èª¤å ´æ™¯

### å¾Œå¤©å¯ä»¥åšï¼ˆå®Œæ•´æµç¨‹ï¼‰
1. âœ… æ¸¬è©¦è³¼è²·é æ¸¬
2. âœ… é©—è­‰å½©å¹£æµè½‰
3. âœ… æ¸¬è©¦å…§å®¹è§£é–
4. âœ… å®Œæ•´ç«¯åˆ°ç«¯æ¸¬è©¦

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

### ç¨‹å¼ç¢¼èª¿æ•´
- [x] èª¿æ•´ `PredictionsQueryParams` ä¸­çš„ `memberId` â†’ `userId`
- [x] åœ¨ `Prediction` ä»‹é¢åŠ å…¥ `purchaseCount` æ¬„ä½
- [x] æ¨™è¨» `selection` å’Œ `note` ç‚ºå¯ç‚º `null`
- [x] ä¿®æ”¹ `MemberPage.vue` çµ±ä¸€ä½¿ç”¨ `getPredictions`
- [x] èª¿æ•´å›æ‡‰æ ¼å¼ `result.total` â†’ `result.pagination.total`

### æ–‡æª”æ›´æ–°
- [x] å»ºç«‹æ•´åˆæ¸¬è©¦è¨ˆåŠƒ
- [x] æ›´æ–° README ç‹€æ…‹
- [x] æ›´æ–° TODO åˆ—è¡¨
- [x] å»ºç«‹å‰ç«¯èª¿æ•´æ‘˜è¦

### æº–å‚™å·¥ä½œ
- [x] ç¢ºèªå¾Œç«¯ API ç«¯é»
- [x] ç¢ºèªå›æ‡‰æ ¼å¼
- [x] ç¢ºèªéŒ¯èª¤ç¢¼
- [x] ç¢ºèªå…§å®¹éš±è—é‚è¼¯

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šé–‹å§‹æ•´åˆæ¸¬è©¦

### æ¸¬è©¦ç’°å¢ƒ
- **å‰ç«¯**: `http://localhost:5173` (Vite é–‹ç™¼ä¼ºæœå™¨)
- **å¾Œç«¯**: `https://10.2.0.2:8080` (Docker ç’°å¢ƒ)

### æ¸¬è©¦å¸³è™Ÿ
- **ç®¡ç†å“¡**: `admin@sgame.com` / `TestPass123!`
- **æ¸¬è©¦ç”¨æˆ¶**: éœ€è¨»å†Šæ–°å¸³è™Ÿé€²è¡Œæ¸¬è©¦

### æ¸¬è©¦è¨ˆåŠƒ
è©³è¦‹ï¼š[å‰å¾Œç«¯æ•´åˆæ¸¬è©¦è¨ˆåŠƒ.md](./å‰å¾Œç«¯æ•´åˆæ¸¬è©¦è¨ˆåŠƒ.md)

---

## ğŸ“Š èª¿æ•´çµ±è¨ˆ

- **ä¿®æ”¹æª”æ¡ˆæ•¸**: 3 å€‹
  - `copy/vue/src/types/prediction.ts`
  - `copy/vue/src/pages/MemberPage.vue`
  - `README.md`
- **èª¿æ•´æ¬„ä½**: 4 å€‹
  - `memberId` â†’ `userId`
  - åŠ å…¥ `purchaseCount`
  - `selection` æ”¹ç‚ºå¯ `null`
  - `note` æ”¹ç‚ºå¯ `null`
- **èª¿æ•´å‡½æ•¸**: 1 å€‹
  - `loadPredictions()` çµ±ä¸€ä½¿ç”¨ `getPredictions`
- **Linter éŒ¯èª¤**: 0 å€‹
- **æº–å‚™å°±ç·’**: âœ… æ˜¯çš„ï¼

---

**å®Œæˆæ™‚é–“**: 2025å¹´10æœˆ22æ—¥  
**å®Œæˆäººå“¡**: AI Assistant  
**ç‰ˆæœ¬**: v1.0  
**ç‹€æ…‹**: âœ… **å‰ç«¯èª¿æ•´å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ•´åˆæ¸¬è©¦**

---

## é™„ä»¶

- [æ•´åˆæ¸¬è©¦è¨ˆåŠƒ](./å‰å¾Œç«¯æ•´åˆæ¸¬è©¦è¨ˆåŠƒ.md)
- [å¾Œç«¯æœ€çµ‚æ¸¬è©¦å ±å‘Š](./api/å‰ç«¯æ•´åˆæ–‡æª”1022/æœ€çµ‚æ¸¬è©¦å ±å‘Š.md)
- [é æ¸¬ç³»çµ±é–‹ç™¼å®Œæˆ](./api/å‰ç«¯æ•´åˆæ–‡æª”1022/é æ¸¬ç³»çµ±é–‹ç™¼å®Œæˆ-å¯æäº¤å‰ç«¯.md)
- [å¿«é€Ÿåƒè€ƒæŒ‡å—](./QUICK_REFERENCE.md)

