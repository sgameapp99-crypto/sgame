# 前後端整合測試計劃

**建立日期**: 2025年10月22日  
**前端狀態**: ✅ 已完成調整，準備整合  
**後端狀態**: ✅ 已通過測試（25/26，96.2%）  
**預計整合時間**: 3-5 個工作日

---

## ✅ 前端已完成的調整

### 1. API 查詢參數調整
- ✅ 將 `memberId` 改為 `userId`（`PredictionsQueryParams`）
- ✅ 統一使用 `getPredictions` API，傳入 `userId` 參數

### 2. 類型定義完善
- ✅ 在 `Prediction` 介面加入 `purchaseCount?: number`
- ✅ 標註 `selection` 和 `note` 可為 `null`（未購買時）
- ✅ 所有類型定義與後端一致

### 3. API 端點確認
- ✅ 彩幣 API：`GET /me/coins`, `POST /me/coins/purchase`
- ✅ 預測 API：`POST /predictions`, `GET /predictions`, `POST /predictions/{id}/purchase`
- ✅ 設定 API：`GET /me/prediction-settings`, `PATCH /me/prediction-settings`

---

## 📋 整合測試階段規劃

### 階段一：基礎功能測試（第 1 天）

#### 1.1 用戶認證 ✓（後端已測試）
- [ ] 前端測試：用戶註冊
- [ ] 前端測試：用戶登入
- [ ] 前端測試：登出功能
- [ ] 前端測試：Session 持久化

**測試重點**：
- Cookie 是否正確設置
- Session 是否在刷新頁面後保持
- 登出後是否清除 Session

#### 1.2 彩幣系統 ✓（後端已測試）
- [ ] 前端測試：查詢彩幣帳戶（`GET /me/coins`）
- [ ] 前端測試：彩幣充值（`POST /me/coins/purchase`）
- [ ] 前端測試：查詢交易記錄（`GET /me/coins/transactions`）

**測試重點**：
- 餘額顯示是否正確
- 充值後餘額是否即時更新
- 交易記錄是否完整

**預期結果**：
```json
{
  "success": true,
  "accountId": "12345678",
  "balance": 2000,
  "earned": 2000,
  "spent": 0
}
```

#### 1.3 預測設定 ✓（後端已測試）
- [ ] 前端測試：查詢預測設定（`GET /me/prediction-settings`）
- [ ] 前端測試：更新預測設定（`PATCH /me/prediction-settings`）

**測試重點**：
- 預設值是否正確（price=100, allowPurchase=true, autoPublish=true）
- 更新後是否立即生效
- 新建預測是否使用新設定

---

### 階段二：賽事與預測建立（第 2 天）

#### 2.1 賽事查詢 ✓（後端已測試）
- [ ] 前端測試：查詢賽事列表（`GET /games`）
- [ ] 前端測試：按聯盟篩選
- [ ] 前端測試：按日期篩選
- [ ] 前端測試：按狀態篩選

**測試重點**：
- 賽事資料是否完整
- 賠率資料是否正確
- 篩選功能是否生效

**預期結果**：
```json
{
  "success": true,
  "data": [
    {
      "gameId": "GAME_ID",
      "allianceId": 1,
      "allianceName": "MLB",
      "sportType": "baseball",
      "gameDate": "2025-10-25",
      "gameTime": "19:05",
      "status": "scheduled",
      "homeTeam": { "id": 110, "name": "洛杉磯道奇" },
      "awayTeam": { "id": 111, "name": "舊金山巨人" },
      "internationalOdds": { ... },
      "taiwanOdds": { ... }
    }
  ]
}
```

#### 2.2 預測建立 ✓（後端已測試）
- [ ] 前端測試：建立國際盤讓分預測
- [ ] 前端測試：建立國際盤大小分預測
- [ ] 前端測試：建立台灣盤讓分預測
- [ ] 前端測試：建立台灣盤獨贏預測
- [ ] 前端測試：建立台灣盤大小分預測

**測試重點**：
- 預測建立成功返回 `predictionId`
- 自動套用預設價格
- 賠率是否正確記錄

**測試場景**：
```bash
# 用戶 A 建立預測
- 選擇賽事：洛杉磯道奇 vs 舊金山巨人
- 選擇類型：國際盤讓分
- 選擇：主隊 -1.5
- 賠率：1.85
- 價格：100（自動套用設定）
- 說明：主場優勢明顯
```

**預期結果**：
```json
{
  "success": true,
  "message": "預測已建立",
  "predictionId": 123
}
```

#### 2.3 錯誤場景測試
- [ ] 賽事已開始時建立預測（期望：`GAME_STARTED`）
- [ ] 重複建立相同預測（期望：`PREDICTION_EXISTS`）
- [ ] 賽事不存在（期望：`GAME_NOT_FOUND`）

---

### 階段三：預測查看與購買（第 3 天）

#### 3.1 預測列表查詢 ✓（後端已測試）
- [ ] 前端測試：查詢自己的預測（不傳 `userId`）
- [ ] 前端測試：查詢其他會員的預測（傳入 `userId`）
- [ ] 前端測試：按狀態篩選
- [ ] 前端測試：分頁功能

**測試重點**：
- 查詢參數是否正確
- 分頁是否正常
- 資料筆數是否正確

**測試場景**：
```typescript
// 查詢用戶 A 的預測
const result = await predictionsAPI.getPredictions({
  userId: 'USER_A_ID',
  page: 1,
  size: 20,
});
```

#### 3.2 內容隱藏邏輯驗證 ⭐ 重點
- [ ] 前端測試：用戶 B 查看用戶 A 的預測（未購買）
  - 期望：`selection = null`, `note = null`, `selectionLabel = "***"`
  - 期望：`isPurchased = false`, `isOwn = false`
  
- [ ] 前端測試：用戶 A 查看自己的預測
  - 期望：完整顯示所有內容
  - 期望：`isOwn = true`

**後端已驗證**：
```json
// 未購買時
{
  "selection": null,
  "selectionLabel": "***",
  "note": null,
  "isPurchased": false,
  "isOwn": false
}

// 本人或已購買
{
  "selection": "home",
  "selectionLabel": "主 -1.5",
  "note": "主場優勢明顯",
  "isPurchased": true,
  "isOwn": false
}
```

#### 3.3 預測購買功能 ✓（後端已測試）
- [ ] 前端測試：用戶 B 購買用戶 A 的預測
- [ ] 前端測試：購買後彩幣扣除（用戶 B）
- [ ] 前端測試：購買後彩幣增加（用戶 A）
- [ ] 前端測試：購買後內容解鎖

**測試場景**：
```bash
用戶 B 初始餘額：500 彩幣
預測價格：100 彩幣

步驟：
1. 用戶 B 查看預測（看不到內容）
2. 用戶 B 購買預測
3. 檢查用戶 B 餘額：500 - 100 = 400 ✓
4. 檢查用戶 A 餘額：原本 + 100 ✓
5. 用戶 B 再次查看預測（可以看到完整內容）✓
```

**預期結果**：
```json
{
  "success": true,
  "message": "購買成功",
  "remainingCoins": 400,
  "prediction": {
    "selection": "home",
    "selectionLabel": "主 -1.5",
    "note": "主場優勢明顯"
  }
}
```

#### 3.4 購買錯誤場景測試 ✓（後端已測試）
- [ ] 重複購買（期望：`ALREADY_PURCHASED`）
- [ ] 購買自己的預測（期望：`SELF_PURCHASE`）
- [ ] 餘額不足（期望：`INSUFFICIENT_BALANCE`）
- [ ] 賽事已結束（期望：`GAME_FINISHED`）

---

### 階段四：完整流程測試（第 4 天）

#### 4.1 端到端測試場景

**場景：完整的預測生命週期**

```
第一步：準備環境
- 管理員建立測試賽事（洛杉磯道奇 vs 舊金山巨人，2025-10-25 19:05）

第二步：賣家操作（用戶 A）
1. 註冊/登入
2. 充值 2000 彩幣
3. 建立預測（主隊讓分 -1.5，價格 100）
4. 確認自己可以看到完整內容

第三步：買家操作（用戶 B）
1. 註冊/登入
2. 充值 500 彩幣
3. 查看用戶 A 的預測（內容隱藏）
4. 購買預測（花費 100 彩幣）
5. 確認可以看到完整內容
6. 嘗試重複購買（被拒絕）

第四步：驗證彩幣流轉
- 用戶 A 餘額：2000 + 100 = 2100 ✓
- 用戶 B 餘額：500 - 100 = 400 ✓
- 交易記錄完整

第五步：賽事結果（管理員）
- 更新賽事結果（主隊 6:3 客隊）
- 計算預測結果（主隊讓 1.5 = 勝）
- 預測狀態更新為 'win'

第六步：驗證最終狀態
- 預測狀態顯示「勝」
- 所有資料一致
```

#### 4.2 UI/UX 測試
- [ ] 載入狀態顯示
- [ ] 錯誤訊息顯示
- [ ] 成功訊息提示
- [ ] 按鈕禁用狀態
- [ ] 表單驗證

#### 4.3 效能測試
- [ ] 大量預測列表載入
- [ ] 頻繁切換頁面
- [ ] 同時多個請求

---

### 階段五：邊界條件與異常測試（第 5 天）

#### 5.1 邊界條件
- [ ] 價格為 0 的免費預測
- [ ] 價格為 10000 的高價預測
- [ ] 預測列表為空
- [ ] 賽事列表為空
- [ ] 交易記錄為空

#### 5.2 網路異常
- [ ] API 超時
- [ ] 網路斷線
- [ ] 5xx 錯誤
- [ ] 非預期的回應格式

#### 5.3 權限測試
- [ ] 未登入訪問需登入的頁面
- [ ] 操作他人的預測
- [ ] 訪問不存在的資源

---

## 🎯 測試檢查清單

### 功能測試
- [ ] 用戶註冊與登入
- [ ] 彩幣充值與查詢
- [ ] 預測設定管理
- [ ] 賽事列表查詢
- [ ] 預測建立（5 種類型）
- [ ] 預測列表查詢
- [ ] 內容隱藏邏輯
- [ ] 預測購買
- [ ] 彩幣流轉
- [ ] 錯誤處理

### 整合測試
- [ ] 端到端流程
- [ ] 彩幣交易一致性
- [ ] 內容解鎖即時性
- [ ] 多用戶互動

### UI/UX 測試
- [ ] 響應式設計
- [ ] 載入狀態
- [ ] 錯誤提示
- [ ] 成功反饋

---

## 📝 測試記錄表格

| 功能 | 狀態 | 測試日期 | 測試人員 | 備註 |
|------|------|---------|---------|------|
| 用戶註冊 | ⏳ | - | - | - |
| 用戶登入 | ⏳ | - | - | - |
| 彩幣查詢 | ⏳ | - | - | - |
| 彩幣充值 | ⏳ | - | - | - |
| 預測設定 | ⏳ | - | - | - |
| 賽事查詢 | ⏳ | - | - | - |
| 建立預測 | ⏳ | - | - | - |
| 預測列表 | ⏳ | - | - | - |
| 內容隱藏 | ⏳ | - | - | - |
| 購買預測 | ⏳ | - | - | - |
| 彩幣流轉 | ⏳ | - | - | - |
| 錯誤處理 | ⏳ | - | - | - |

**圖例**：
- ⏳ 待測試
- 🔄 測試中
- ✅ 通過
- ❌ 失敗
- ⚠️ 部分通過

---

## 🔧 開發環境設定

### 前端
```bash
cd /home/gogofire1774/sgame/copy/vue
npm install
npm run dev
```

### 後端
```bash
# 後端已在 Docker 中運行
Base URL: https://10.2.0.2:8080
```

### 測試帳號
- 管理員：`admin@sgame.com` / `TestPass123!`
- 測試用戶 A：需註冊
- 測試用戶 B：需註冊

---

## 📊 預期結果與實際結果對比

### 關鍵功能對比

| 功能 | 前端期望 | 後端實作 | 狀態 |
|------|---------|---------|------|
| 建立預測 | `POST /predictions` | ✅ | 一致 |
| 預測 ID | `predictionId` | `id` | ✅ 已調整 |
| 購買後餘額 | `newBalance` | `remainingCoins` | ✅ 已知差異 |
| 查詢參數 | `userId` | `userId` | ✅ 已調整 |
| 內容隱藏 | null + "***" | null + "***" | ✅ 一致 |
| 錯誤碼 | 完整清單 | 完整清單 | ✅ 一致 |

---

## 🚀 開始整合！

### 第一步：啟動前端開發環境
```bash
cd /home/gogofire1774/sgame/copy/vue
npm run dev
```

### 第二步：開啟瀏覽器
```
http://localhost:5173
```

### 第三步：開始測試
按照本文檔的階段規劃，逐步測試每個功能。

### 第四步：記錄問題
發現問題時，記錄在 `整合測試問題清單.md`。

---

## 📞 聯絡方式

**前端團隊**：
- 負責人：AI Assistant
- 文檔：`/預測系統前端整合完成報告.md`

**後端團隊**：
- 負責人：（待確認）
- 文檔：`/api/前端整合文檔1022/最終測試報告.md`

---

**建立日期**: 2025年10月22日  
**版本**: v1.0  
**狀態**: 📋 整合測試準備就緒

