# 整合測試問題清單

**建立日期**: 2025年10月22日  
**狀態**: 🔄 整合測試進行中

---

## 📊 問題統計

| 類別 | 已修復 | 進行中 | 待修復 | 總計 |
|------|--------|--------|--------|------|
| 前端錯誤 | 3 | 0 | 0 | 3 |
| 後端錯誤 | 0 | 0 | 0 | 0 |
| UI 改進 | 1 | 0 | 0 | 1 |
| **總計** | **4** | **0** | **0** | **4** |

---

## ✅ 已修復的問題

### 問題 #1: 彩幣餘額載入錯誤 ✅ 已修復

**發現時間**: 2025-10-22  
**發現位置**: MemberPage.vue:720  
**嚴重程度**: 🔴 高（功能完全無法使用）

#### 錯誤訊息
```
TypeError: coinsAPI.getBalance is not a function
    at loadCoinBalance (MemberPage.vue:715:35)
    at MemberPage.vue:979:11
```

#### 問題原因
前端代碼調用了不存在的函數 `coinsAPI.getBalance()`。

**根本原因**：
- `coinsAPI` 匯出的函數名是 `getCoinInfo`，不是 `getBalance`
- 前端代碼與 API 定義不一致

#### 受影響的功能
- ❌ 會員頁面無法顯示彩幣餘額
- ❌ 無法查看當前彩幣狀態

#### 修正方案
**檔案**: `copy/vue/src/pages/MemberPage.vue`

```diff
async function loadCoinBalance() {
  if (!session.loggedIn) return;

  try {
-   const result = await coinsAPI.getBalance();
-   if (result.success && result.balance) {
-     coinBalance.value = result.balance.balance;
-   }
+   const result = await coinsAPI.getCoinInfo();
+   // 後端返回格式：{ accountId, balance, earned, spent }
+   if (result.balance !== undefined) {
+     coinBalance.value = result.balance;
+   }
  } catch (e) {
    console.warn('載入彩幣餘額失敗:', e);
  }
}
```

#### 修正內容
1. ✅ 函數調用：`getBalance()` → `getCoinInfo()`
2. ✅ 取值方式：`result.balance.balance` → `result.balance`
3. ✅ 加入註解說明後端返回格式

#### 測試結果
- ⏳ 待測試：彩幣餘額是否正確顯示
- ⏳ 待測試：充值後餘額是否更新
- ⏳ 待測試：購買後餘額是否扣除

#### 預防措施
- 📝 建議：在類型定義中加入完整的 API 函數列表
- 📝 建議：使用 TypeScript 嚴格模式捕捉此類錯誤

---

### 問題 #2: 會員頁面缺少彩幣餘額顯示 ✅ 已修復

**發現時間**: 2025-10-22  
**發現位置**: MemberPage.vue 側邊欄  
**嚴重程度**: 🟡 中（功能已實作但 UI 缺失）

#### 問題描述
雖然後端 API 可以正確返回彩幣餘額，且前端已有 `loadCoinBalance()` 函數載入資料，但會員頁面沒有顯示彩幣餘額的 UI。

#### 問題原因
- 變數 `coinBalance` 已定義並載入資料
- 但模板中缺少顯示該變數的 UI 組件

#### 受影響的功能
- ❌ 用戶無法在會員頁面查看當前彩幣餘額

#### 修正方案
**檔案**: `copy/vue/src/pages/MemberPage.vue`

在側邊欄的 `betmember_icon` 區域加入彩幣餘額顯示：

```vue
<!-- 彩幣餘額顯示 -->
<div class="coin-balance-display">
  <div class="coin-balance-label">當前彩幣餘額</div>
  <div class="coin-balance-amount">{{ coinBalance.toLocaleString() }} 彩幣</div>
</div>
```

加入對應的 CSS 樣式：
```css
.coin-balance-display { 
  margin: 15px 0; 
  padding: 12px; 
  background: #f8f9fa; 
  border: 2px solid #e3ffbf; 
  border-radius: 8px; 
  text-align: center; 
}
.coin-balance-label { 
  font-size: 13px; 
  color: #666; 
  margin-bottom: 6px; 
}
.coin-balance-amount { 
  font-size: 20px; 
  font-weight: bold; 
  color: #28a745; 
}
```

#### 修正內容
1. ✅ 在側邊欄加入彩幣餘額顯示區塊
2. ✅ 使用 `toLocaleString()` 格式化數字（加入千分位符號）
3. ✅ 加入清晰的標籤和樣式

#### 測試結果
- ⏳ 待測試：彩幣餘額是否正確顯示
- ⏳ 待測試：充值後餘額是否自動更新
- ⏳ 待測試：樣式是否美觀

#### 更新 (2025-10-22)
**位置調整**: 根據用戶反饋，彩幣餘額已移至側邊欄
- ✅ 從遊戲紀錄區塊移至側邊欄
- ✅ 位置：等級進度條下方、導航選單上方
- ✅ 樣式優化：漸層背景、綠色邊框、置中對齊

---

### 問題 #3: 預測頁面時間選擇器無視覺反饋 ✅ 已修復

**發現時間**: 2025-10-22  
**發現位置**: PredictPage.vue - 時間選擇器（今天、明天、後天）  
**嚴重程度**: 🟡 中（功能運作但缺少視覺反饋）

#### 問題描述
在預測頁面點擊時間選項（今天、明天、後天）時：
- ✅ 功能正常運作（會載入對應日期的賽事）
- ❌ 沒有視覺反饋（未顯示黃底高亮）
- ❌ 用戶無法清楚知道目前選擇的日期

**對比**：
- ✅ 聯盟選單能正常顯示高亮效果
- ❌ 時間選擇器不顯示高亮效果

#### 問題原因
**檔案**: `copy/vue/src/components/AllianceMenu.vue`

`dateOptions` computed 中的 `isSelected` 邏輯錯誤：

```typescript
// ❌ 錯誤邏輯
const isSelected = props.selectedStatusType === statusType && i === 0; // 預設選擇今天
```

**問題分析**：
1. 所有三個選項（今天、明天、後天）的 `statusType` 都是 `'scheduled'`
2. 條件 `i === 0` 固定只高亮「今天」
3. 沒有根據 `props.selectedDate` 來判斷實際選中的日期

#### 受影響的功能
- ❌ 用戶點擊「明天」或「後天」時無法看到選中狀態
- ❌ 用戶體驗不佳，無法確認操作是否生效

#### 修正方案
**檔案**: `copy/vue/src/components/AllianceMenu.vue`

修改 `dateOptions` computed，正確比較選中的日期：

```typescript
// ✅ 正確邏輯
const dateOptions = computed(() => {
  const options = [];
  const dateLabels = ['今天', '明天', '後天'];
  const statusTypes: ('finished' | 'live' | 'scheduled')[] = ['scheduled', 'scheduled', 'scheduled'];

  // 取得今天的日期（只比較年月日，忽略時分秒）
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  for (let i = 0; i < 3; i++) {
    const statusType = statusTypes[i];

    if (props.dateOptionsFilter.includes(statusType)) {
      // 計算對應的日期
      const targetDate = new Date(today);
      targetDate.setDate(today.getDate() + i); // i=0:今天, i=1:明天, i=2:後天
      
      // 比較 selectedDate 和目標日期（只比較年月日）
      const selectedDateOnly = new Date(props.selectedDate);
      selectedDateOnly.setHours(0, 0, 0, 0);
      
      const isSelected = selectedDateOnly.getTime() === targetDate.getTime();

      options.push({
        display: dateLabels[i],
        type: statusType,
        isSelected
      });
    }
  }

  return options;
});
```

#### 修正內容
1. ✅ 加入日期比較邏輯
2. ✅ 將時分秒設為 0，只比較年月日
3. ✅ 根據 `selectedDate` 計算對應的目標日期
4. ✅ 使用 `getTime()` 比較兩個日期是否相同

#### 測試結果
- ⏳ 待測試：點擊「今天」是否顯示黃底
- ⏳ 待測試：點擊「明天」是否顯示黃底
- ⏳ 待測試：點擊「後天」是否顯示黃底
- ⏳ 待測試：切換時間後是否載入正確的賽事

#### 技術細節
**為何需要 `setHours(0, 0, 0, 0)`？**
- JavaScript 的 `Date` 物件包含時分秒毫秒
- 不同時間建立的日期物件可能時分秒不同
- 只比較年月日需要將時分秒歸零

**為何使用 `getTime()`？**
- `Date` 物件不能直接用 `===` 比較
- `getTime()` 返回時間戳（毫秒），可以直接比較數字

---

### 改進 #1: 移除 AppHeader 的彩幣按鈕 ✅ 已完成

**完成時間**: 2025-10-22  
**修改位置**: AppHeader.vue  
**類型**: UI 改進

#### 改進原因
用戶反映登入後在頂部導航欄顯示「彩幣」按鈕不必要，因為：
1. 會員頁面已有彩幣餘額顯示
2. 減少導航欄的視覺雜訊

#### 修正內容
**檔案**: `copy/vue/src/components/AppHeader.vue`

1. ✅ 移除彩幣按鈕的 HTML
2. ✅ 移除彩幣按鈕的 CSS 樣式

```diff
- <li class="coinitem">
-   <a href="/member/coins" class="function-item-button">
-     <i class="material-icons md-small">monetization_on</i>
-     彩幣
-   </a>
- </li>
```

#### 效果
- 頂部導航欄更簡潔
- 用戶仍可在會員頁面查看彩幣餘額

---

## 🔄 進行中的問題

目前沒有進行中的問題。

---

## ⏳ 待修復的問題

目前沒有待修復的問題。

---

## 📋 測試進度

### 階段一：基礎功能測試
- [ ] 用戶註冊
- [ ] 用戶登入
- [x] 彩幣餘額查詢 ⚠️ 發現並修復問題 #1, #2
- [ ] 彩幣充值
- [ ] 交易記錄查詢
- [ ] 預測設定查詢
- [ ] 預測設定更新

### 階段二：賽事與預測
- [ ] 賽事列表查詢
- [ ] 建立預測
- [ ] 預測列表查詢

### 階段三：購買功能
- [ ] 購買預測
- [ ] 內容隱藏驗證
- [ ] 內容解鎖驗證
- [ ] 彩幣流轉驗證

---

## 🔍 已驗證的功能

目前還沒有完成驗證的功能。

---

## 💡 發現的改進建議

### 建議 #1: API 函數命名一致性
**優先級**: 中  
**類別**: 代碼品質

**問題描述**：
- `coinsAPI` 使用 `getCoinInfo`
- 其他 API 可能使用不同的命名慣例

**改進建議**：
1. 統一命名規範：`getXxx`, `createXxx`, `updateXxx`, `deleteXxx`
2. 在類型定義中明確列出所有可用函數
3. 使用 TypeScript 的 `typeof` 確保類型安全

**預期效益**：
- 減少類似的函數調用錯誤
- 提高代碼可維護性
- 改善開發體驗

---

## 🎯 後續測試重點

基於問題 #1 的發現，建議特別測試：

### 優先測試項目
1. ⭐⭐⭐ 所有 API 調用是否使用正確的函數名
2. ⭐⭐⭐ 回應格式是否與類型定義一致
3. ⭐⭐ 錯誤處理是否完善

### 測試方法
1. 逐一測試每個功能頁面
2. 檢查瀏覽器控制台是否有錯誤
3. 驗證資料是否正確顯示

---

## 📞 問題回報格式

發現新問題時，請使用以下格式記錄：

```markdown
### 問題 #X: [問題標題]

**發現時間**: YYYY-MM-DD
**發現位置**: 檔案名:行號
**嚴重程度**: 🔴高 / 🟡中 / 🟢低

#### 錯誤訊息
[錯誤訊息內容]

#### 問題原因
[問題分析]

#### 受影響的功能
[列出受影響的功能]

#### 修正方案
[說明如何修正]

#### 測試結果
[修正後的測試結果]
```

---

## 📊 每日測試總結

### 2025-10-22

#### 測試時間
- 開始：[時間]
- 結束：[時間]
- 總計：[時數]

#### 測試項目
- 測試功能數：3
- 發現問題數：3
- 修復問題數：3
- UI 改進數：1

#### 主要發現
- ✅ 發現並修復彩幣餘額載入錯誤（問題 #1）
- ✅ 發現並修復會員頁面彩幣餘額顯示缺失（問題 #2）
- ✅ 發現並修復預測頁面時間選擇器無視覺反饋（問題 #3）
- ✅ 完成 AppHeader 彩幣按鈕移除（改進 #1）
- 📝 建議加強 API 函數命名一致性

#### 明日計劃
1. 完成基礎功能測試（階段一）
2. 開始賽事與預測測試（階段二）
3. 驗證所有 API 調用的正確性

---

**維護人員**: AI Assistant  
**更新時間**: 2025-10-22  
**版本**: v1.0

**相關文檔**：
- [整合測試計劃](./前後端整合測試計劃.md)
- [前端調整完成摘要](./前端調整完成摘要.md)

