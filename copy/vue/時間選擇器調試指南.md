# 時間選擇器調試指南

**問題**: 會員頁面的時間選擇器（一週內、一個月內、全部）無法正確點擊或沒有觸發 API 請求。

**日期**: 2025-10-22

---

## 🔍 問題診斷

我已經在相關代碼中添加了詳細的調試日誌，請按以下步驟操作：

### 第一步：清除緩存並刷新

1. 清除瀏覽器緩存（Ctrl+Shift+Delete 或 Cmd+Shift+Delete）
2. 硬刷新頁面（Ctrl+F5 或 Cmd+Shift+R）
3. 打開開發者工具（F12）
4. 切換到 **Console** 標籤

### 第二步：查看初始化日誌

頁面載入後，應該會看到以下日誌：

```
📊 dateOptions 計算屬性執行
📊 props.dateOptionsFilter: ['week', 'month', 'all']
📊 hasRangeOptions: true
📊 生成的日期範圍選項: [
  { display: '一週內', type: 'week', isSelected: false },
  { display: '一個月內', type: 'month', isSelected: false },
  { display: '全部', type: 'all', isSelected: false }
]
```

**如果沒有看到這些日誌**：
- 可能是 AllianceMenu 組件沒有正確載入
- 檢查頁面上是否顯示「時間」區塊

### 第三步：點擊時間選項

嘗試點擊「一週內」、「一個月內」或「全部」選項。

#### ✅ 正常情況應該看到：

```
🎯 AllianceMenu - handleDateOptionClick 被調用
🎯 接收到的 option: { display: '一週內', type: 'week', isSelected: false }
🎯 option.type: week
🎯 option.display: 一週內
🎯 準備 emit select-date-option 事件，參數: { ... }
🎯 emit 完成
📅 selectDateOption 被調用，接收到的參數: { display: '一週內', type: 'week', isSelected: false }
📅 參數類型: object
📅 option.type: week
📅 option.value: undefined
📅 最終的 rangeValue: week
📅 設置後的 selectedDateRange.value: week
🔍 載入會員預測 - 請求參數: { memberId: 27, page: 1, size: 20, startDate: "2025-10-22", endDate: "2025-10-29" }
...
```

#### ❌ 異常情況 1：沒有任何日誌

**可能原因**：
- 點擊事件沒有綁定
- 事件被其他元素攔截
- 元素被 CSS 隱藏或覆蓋

**解決方案**：
1. 檢查元素是否可見：
   ```javascript
   // 在控制台執行
   document.querySelectorAll('.tag-con li')
   ```
2. 檢查是否有 CSS `pointer-events: none`
3. 嘗試直接在控制台調用函數（見下方「手動測試」）

#### ❌ 異常情況 2：只有 🎯 日誌，沒有 📅 日誌

**可能原因**：
- `@select-date-option` 事件沒有正確綁定到 `selectDateOption` 函數
- 父組件（MemberPage.vue）沒有正確監聽事件

**解決方案**：
檢查 MemberPage.vue 中的事件綁定：
```vue
<AllianceMenu
  ...
  @select-date-option="selectDateOption"  <!-- 確認這一行存在 -->
  ...
/>
```

#### ❌ 異常情況 3：有日誌但參數為 undefined

```
📅 接收到的參數: undefined
📅 參數類型: undefined
```

**可能原因**：
- AllianceMenu 的 emit 沒有正確傳遞參數
- Vue 版本不兼容

**解決方案**：
檢查 Vue DevTools 中的事件流。

---

## 🧪 手動測試

如果點擊無反應，嘗試在控制台手動測試：

### 測試 1：檢查 dateOptions 是否正確生成

```javascript
// 在 Vue DevTools 中找到 AllianceMenu 組件
// 查看其 computed properties 中的 dateOptions
```

應該看到：
```javascript
[
  { display: '一週內', type: 'week', isSelected: false },
  { display: '一個月內', type: 'month', isSelected: false },
  { display: '全部', type: 'all', isSelected: false }
]
```

### 測試 2：手動觸發 loadPredictions

```javascript
// 在控制台執行（需要在 MemberPage 組件上下文中）
// 這個方法可能需要根據實際情況調整
```

---

## 🔧 常見問題與解決方案

### 問題 1：時間選項不顯示

**檢查**：
1. 查看頁面上是否有「時間」標題的區塊
2. 查看是否有三個選項（一週內、一個月內、全部）

**如果沒有顯示**：
- 檢查 MemberPage.vue 中的 `:show-time-selector="true"`
- 檢查 `:date-options-filter="['week', 'month', 'all']"`
- 檢查控制台是否有錯誤

### 問題 2：點擊沒有反應

**可能原因**：
1. **CSS 層級問題**：其他元素覆蓋了按鈕
   ```javascript
   // 檢查元素的 z-index 和 position
   const el = document.querySelector('.tag-con li');
   console.log(window.getComputedStyle(el).pointerEvents);
   // 應該是 "auto" 而不是 "none"
   ```

2. **事件冒泡被阻止**：父元素阻止了事件
   ```javascript
   // 檢查父元素是否有 @click.stop
   ```

3. **Vue 組件沒有正確掛載**
   ```javascript
   // 在 Vue DevTools 中檢查組件樹
   // 確認 AllianceMenu 組件已掛載
   ```

### 問題 3：點擊後沒有發送 API 請求

**檢查 Network 標籤**：
1. 切換到 Network 標籤
2. 點擊時間選項
3. 查看是否有新的 `/api/predictions` 請求

**如果沒有請求**：
- 檢查 `loadPredictions()` 函數是否被調用（查看控制台日誌）
- 檢查是否有錯誤阻止了請求發送

### 問題 4：選項點擊後沒有視覺反饋

**正常情況**：
- 點擊選項時，應該有輕微的縮放動畫（`transform: scale(0.95)`）

**如果沒有視覺反饋**：
- 可能是 CSS transition 沒有生效
- 或者點擊事件確實沒有觸發

---

## 📊 調試日誌說明

### 日誌圖標說明

- 📊 = AllianceMenu 組件內部的計算屬性
- 🎯 = AllianceMenu 組件的事件處理
- 📅 = MemberPage 組件的事件接收
- 🔍 = API 請求準備
- ✅ = API 請求成功
- ❌ = 錯誤

### 完整的調用鏈

```
用戶點擊「一週內」
    ↓
🎯 AllianceMenu.handleDateOptionClick 被調用
    ↓
emit('select-date-option', { type: 'week', ... })
    ↓
📅 MemberPage.selectDateOption 接收參數
    ↓
selectedDateRange.value = 'week'
    ↓
loadPredictions() 被調用
    ↓
🔍 構建 API 請求參數（包含 endDate = 今天+7天）
    ↓
發送 GET /api/predictions?memberId=27&startDate=...&endDate=...
    ↓
✅ 收到 API 回應
    ↓
更新 predictions 陣列
```

---

## 🎯 快速檢查清單

請依序檢查以下項目，並記錄結果：

- [ ] 1. 頁面上是否顯示「時間」區塊？
- [ ] 2. 是否顯示三個選項（一週內、一個月內、全部）？
- [ ] 3. 點擊選項時，控制台是否有 🎯 日誌？
- [ ] 4. 是否出現 📅 日誌？
- [ ] 5. 是否出現 🔍 載入預測的日誌？
- [ ] 6. Network 標籤中是否有 `/api/predictions` 請求？
- [ ] 7. API 請求的 query parameters 是否正確（包含 startDate, endDate）？
- [ ] 8. API 請求是否返回 200 狀態碼？
- [ ] 9. 頁面是否顯示了預測數據？

---

## 💡 臨時解決方案

如果時間選擇器無法正常工作，可以使用以下臨時方案：

### 方案 1：手動設置日期範圍

在瀏覽器控制台執行：

```javascript
// 設置為一週內
// （需要根據實際的組件引用方式調整）
```

### 方案 2：移除日期篩選

如果您只想查看所有預測，可以暫時註釋掉 startDate 和 endDate：

```typescript
// 在 MemberPage.vue 的 loadPredictions 函數中
const result = await predictionsAPI.getPredictions({
  memberId: userId,
  page: currentPage.value,
  size: pageSize.value,
  // startDate: startDate,  // 暫時註釋
  // endDate: endDate,      // 暫時註釋
});
```

這樣會查詢所有預測，不受日期限制。

---

## 📞 需要提供的信息

如果問題仍未解決，請提供以下完整信息：

### 1. 控制台日誌（完整）

包括所有 📊 🎯 📅 🔍 ✅ ❌ 開頭的日誌

### 2. 頁面截圖

- 會員頁面的完整截圖
- 特別標註「時間」選擇區塊的位置

### 3. Vue DevTools 信息

- MemberPage 組件的 data（特別是 selectedDateRange）
- AllianceMenu 組件的 props 和 computed properties

### 4. Network 信息

- 是否有 `/api/predictions` 請求
- 如果有，完整的 Request URL 和 Query Parameters
- Response 內容

### 5. 嘗試過的操作

- 已檢查的清單項目
- 已嘗試的解決方案
- 觀察到的異常行為

---

**請先執行上述診斷步驟，並將控制台日誌完整複製給我！** 📝

