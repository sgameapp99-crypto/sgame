<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGame API å®Œæ•´æ¸¬è©¦é é¢</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", Arial, sans-serif;
            padding: 20px;
            background: #f5f7fa;
            margin: 0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            margin: 0 0 15px 0;
            color: #34495e;
            font-size: 18px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        .category-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }
        .badge-auth { background: #3498db; color: white; }
        .badge-member { background: #9b59b6; color: white; }
        .badge-system { background: #2ecc71; color: white; }
        .input-group {
            margin-bottom: 12px;
        }
        .input-group label {
            display: block;
            margin-bottom: 4px;
            color: #555;
            font-size: 13px;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-secondary { background: #95a5a6; color: white; }
        .result-box {
            margin-top: 12px;
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }
        .result-box pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .result-pending {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        .status-success { background: #2ecc71; }
        .status-error { background: #e74c3c; }
        .status-pending { background: #f39c12; }
        .file-upload {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        .file-upload input[type="file"] {
            display: none;
        }
        .quick-guide {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .quick-guide h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
        }
        .quick-guide ol {
            margin: 0;
            padding-left: 20px;
        }
        .quick-guide li {
            margin-bottom: 8px;
            color: #555;
        }
        .stats-bar {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-item {
            flex: 1;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® SGame API å®Œæ•´æ¸¬è©¦é é¢</h1>
        <p class="subtitle">æ¸¬è©¦æ‰€æœ‰ 21 å€‹ API ç«¯é» | å¾Œç«¯: https://10.2.0.2:8080</p>

        <!-- å¿«é€Ÿæ¸¬è©¦æŒ‡å— -->
        <div class="quick-guide">
            <h3>ğŸ“‹ æ¸¬è©¦æµç¨‹å»ºè­°</h3>
            <ol>
                <li><strong>åŸºç¤é€£æ¥</strong>: å…ˆæ¸¬è©¦ã€Œå¥åº·æª¢æŸ¥ã€ç¢ºèªå¾Œç«¯é€£æ¥æ­£å¸¸</li>
                <li><strong>è¨»å†Šå¸³è™Ÿ</strong>: ä½¿ç”¨ã€Œè¨»å†Šæ¸¬è©¦ã€å‰µå»ºæ–°å¸³è™Ÿ (éœ€è¦çœŸå¯¦Emailæ¥æ”¶é©—è­‰ç¢¼)</li>
                <li><strong>ç™»å…¥ç³»çµ±</strong>: ä½¿ç”¨ã€Œç™»å…¥æ¸¬è©¦ã€ç™»å…¥å‰›è¨»å†Šçš„å¸³è™Ÿ</li>
                <li><strong>é©—è­‰éƒµç®±</strong>: ç™¼é€é©—è­‰ç¢¼ä¸¦å®Œæˆé©—è­‰ (æª¢æŸ¥Emailæ”¶ä»¶åŒ£)</li>
                <li><strong>æœƒå“¡åŠŸèƒ½</strong>: æ¸¬è©¦æœƒå“¡è³‡æ–™ã€è¿½è¹¤ã€ç­‰ç´šç­‰åŠŸèƒ½</li>
                <li><strong>å…¶ä»–åŠŸèƒ½</strong>: æ¸¬è©¦å¯†ç¢¼ç®¡ç†ã€é ­åƒä¸Šå‚³ç­‰é€²éšåŠŸèƒ½</li>
            </ol>
        </div>

        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="stat-total">21</div>
                <div class="stat-label">ç¸½APIæ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-tested">0</div>
                <div class="stat-label">å·²æ¸¬è©¦</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-success">0</div>
                <div class="stat-label">æˆåŠŸ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-failed">0</div>
                <div class="stat-label">å¤±æ•—</div>
            </div>
        </div>

        <!-- æ¸¬è©¦å€åŸŸ -->
        <div class="test-grid">
            <!-- 1. ç³»çµ±å¥åº·æª¢æŸ¥ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-health"></span>
                    1. å¥åº·æª¢æŸ¥
                    <span class="category-badge badge-system">SYSTEM</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testHealth()">æ¸¬è©¦å¥åº·æª¢æŸ¥</button>
                </div>
                <div id="health-result"></div>
            </div>

            <!-- 2. Session ç‹€æ…‹ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-session"></span>
                    2. Session ç‹€æ…‹
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testSession()">æª¢æŸ¥ Session</button>
                </div>
                <div id="session-result"></div>
            </div>

            <!-- 3. è¨»å†Š -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-register"></span>
                    3. è¨»å†Šå¸³è™Ÿ
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="register-email" placeholder="your@example.com">
                </div>
                <div class="input-group">
                    <label>å¯†ç¢¼ (8-12ç¢¼,å«å¤§å°å¯«+æ•¸å­—+ç‰¹æ®Šç¬¦è™Ÿ)</label>
                    <input type="password" id="register-password" placeholder="Abcd1234!">
                </div>
                <div class="input-group">
                    <label>åç¨±</label>
                    <input type="text" id="register-name" placeholder="æ¸¬è©¦ç”¨æˆ¶">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="testRegister()">è¨»å†Š</button>
                </div>
                <div id="register-result"></div>
            </div>

            <!-- 4. ç™»å…¥ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-login"></span>
                    4. ç™»å…¥
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="email" placeholder="your@example.com">
                </div>
                <div class="input-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" id="password" placeholder="å¯†ç¢¼">
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="testLogin()">ç™»å…¥</button>
                </div>
                <div id="login-result"></div>
            </div>

            <!-- 5. éƒµç®±é©—è­‰ç‹€æ…‹ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-verify-status"></span>
                    5. éƒµç®±é©—è­‰ç‹€æ…‹
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testVerificationStatus()">æŸ¥è©¢é©—è­‰ç‹€æ…‹</button>
                </div>
                <div id="verify-status-result"></div>
            </div>

            <!-- 6. ç™¼é€é©—è­‰ç¢¼ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-send-verify"></span>
                    6. ç™¼é€é©—è­‰ç¢¼
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <p style="font-size: 13px; color: #666; margin-top: 0;">éœ€è¦å…ˆç™»å…¥,é©—è­‰ç¢¼å°‡ç™¼é€åˆ°ç™»å…¥çš„Email</p>
                <div class="button-group">
                    <button class="btn-warning" onclick="testSendVerification()">ç™¼é€é©—è­‰ç¢¼</button>
                </div>
                <div id="send-verify-result"></div>
            </div>

            <!-- 7. é©—è­‰éƒµç®± -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-verify-email"></span>
                    7. é©—è­‰éƒµç®±
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>é©—è­‰ç¢¼ (6ä½æ•¸)</label>
                    <input type="text" id="verify-code" placeholder="123456" maxlength="6">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="testVerifyEmail()">æäº¤é©—è­‰</button>
                </div>
                <div id="verify-email-result"></div>
            </div>

            <!-- 8. æœƒå“¡è³‡æ–™ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-member"></span>
                    8. æœƒå“¡è³‡æ–™
                    <span class="category-badge badge-member">MEMBER</span>
                </h2>
                <div class="input-group">
                    <label>æœƒå“¡ID</label>
                    <input type="text" id="member-id" placeholder="1">
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="testMemberProfile()">æŸ¥è©¢æœƒå“¡</button>
                </div>
                <div id="member-result"></div>
            </div>

            <!-- 9. è¿½è¹¤æœƒå“¡ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-follow"></span>
                    9. è¿½è¹¤æœƒå“¡
                    <span class="category-badge badge-member">MEMBER</span>
                </h2>
                <div class="input-group">
                    <label>è¦è¿½è¹¤çš„æœƒå“¡ID</label>
                    <input type="text" id="follow-member-id" placeholder="2">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="testFollowMember()">è¿½è¹¤</button>
                    <button class="btn-danger" onclick="testUnfollowMember()">å–æ¶ˆè¿½è¹¤</button>
                </div>
                <div id="follow-result"></div>
            </div>

            <!-- 10. ç­‰ç´šç³»çµ± -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-levels"></span>
                    10. ç­‰ç´šåˆ—è¡¨
                    <span class="category-badge badge-system">SYSTEM</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testLevels()">ç²å–ç­‰ç´š</button>
                </div>
                <div id="levels-result"></div>
            </div>

            <!-- 11. ç­‰ç´šçµ±è¨ˆ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-level-stats"></span>
                    11. ç­‰ç´šçµ±è¨ˆ
                    <span class="category-badge badge-system">SYSTEM</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testLevelStats()">ç²å–çµ±è¨ˆ</button>
                </div>
                <div id="level-stats-result"></div>
            </div>

            <!-- 12. å¯†ç¢¼éæœŸç‹€æ…‹ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-pwd-expiry"></span>
                    12. å¯†ç¢¼éæœŸç‹€æ…‹
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="testPasswordExpiry()">æŸ¥è©¢ç‹€æ…‹</button>
                </div>
                <div id="pwd-expiry-result"></div>
            </div>

            <!-- 13. ä¿®æ”¹å¯†ç¢¼ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-change-pwd"></span>
                    13. ä¿®æ”¹å¯†ç¢¼
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>ç›®å‰å¯†ç¢¼</label>
                    <input type="password" id="current-password" placeholder="ç›®å‰å¯†ç¢¼">
                </div>
                <div class="input-group">
                    <label>æ–°å¯†ç¢¼</label>
                    <input type="password" id="new-password" placeholder="NewPass1234!">
                </div>
                <div class="button-group">
                    <button class="btn-warning" onclick="testChangePassword()">ä¿®æ”¹å¯†ç¢¼</button>
                </div>
                <div id="change-pwd-result"></div>
            </div>

            <!-- 14. å¿˜è¨˜å¯†ç¢¼ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-forgot-pwd"></span>
                    14. å¿˜è¨˜å¯†ç¢¼
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="forgot-email" placeholder="your@example.com">
                </div>
                <div class="button-group">
                    <button class="btn-warning" onclick="testForgotPassword()">ç™¼é€é‡è¨­éƒµä»¶</button>
                </div>
                <div id="forgot-pwd-result"></div>
            </div>

            <!-- 15. é©—è­‰é‡è¨­Token -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-verify-token"></span>
                    15. é©—è­‰é‡è¨­Token
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>é‡è¨­Token (å¾éƒµä»¶ä¸­å–å¾—)</label>
                    <input type="text" id="reset-token" placeholder="token-from-email">
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="testVerifyResetToken()">é©—è­‰Token</button>
                </div>
                <div id="verify-token-result"></div>
            </div>

            <!-- 16. é‡è¨­å¯†ç¢¼ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-reset-pwd"></span>
                    16. é‡è¨­å¯†ç¢¼
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="input-group">
                    <label>é‡è¨­Token</label>
                    <input type="text" id="reset-pwd-token" placeholder="token-from-email">
                </div>
                <div class="input-group">
                    <label>æ–°å¯†ç¢¼</label>
                    <input type="password" id="reset-new-password" placeholder="NewPass1234!">
                </div>
                <div class="button-group">
                    <button class="btn-success" onclick="testResetPassword()">é‡è¨­å¯†ç¢¼</button>
                </div>
                <div id="reset-pwd-result"></div>
            </div>

            <!-- 17. é ­åƒä¸Šå‚³ -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-avatar"></span>
                    17. é ­åƒä¸Šå‚³
                    <span class="category-badge badge-member">MEMBER</span>
                </h2>
                <div class="file-upload" onclick="document.getElementById('avatar-file').click()">
                    <input type="file" id="avatar-file" accept="image/jpeg,image/png,image/webp">
                    <p style="margin: 0; color: #666;">é»æ“Šé¸æ“‡åœ–ç‰‡ (æœ€å¤§5MB, JPEG/PNG/WebP)</p>
                    <p id="avatar-filename" style="margin: 8px 0 0 0; color: #3498db; font-size: 13px;"></p>
                </div>
                <div class="button-group" style="margin-top: 12px;">
                    <button class="btn-success" onclick="testUploadAvatar()">ä¸Šå‚³é ­åƒ</button>
                </div>
                <div id="avatar-result"></div>
            </div>

            <!-- 18. Google OAuth -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-google-oauth"></span>
                    18. Google OAuth
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 12px; margin-bottom: 12px;">
                    <p style="margin: 0; font-size: 13px; color: #856404;">
                        âš ï¸ <strong>é–‹ç™¼ç’°å¢ƒé™åˆ¶</strong>: Google OAuth ä¸æ”¯æ´ç§æœ‰ IP (10.x.x.x) ä½œç‚º callback URL,éœ€è¦å…¬ç¶²ç’°å¢ƒæ‰èƒ½æ¸¬è©¦ã€‚ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ™‚åªéœ€æ›´æ–° <code>GOOGLE_CALLBACK_URL</code> ç’°å¢ƒè®Šæ•¸å³å¯ä½¿ç”¨ã€‚
                    </p>
                </div>
                <div class="button-group">
                    <button class="btn-secondary" onclick="testGoogleOAuth()" disabled>Google ç™»å…¥ (é–‹ç™¼ç’°å¢ƒä¸å¯ç”¨)</button>
                </div>
                <div id="google-oauth-result"></div>
            </div>

            <!-- 19. ç™»å‡º -->
            <div class="test-section">
                <h2>
                    <span class="status-indicator" id="status-logout"></span>
                    19. ç™»å‡º
                    <span class="category-badge badge-auth">AUTH</span>
                </h2>
                <div class="button-group">
                    <button class="btn-danger" onclick="testLogout()">ç™»å‡º</button>
                </div>
                <div id="logout-result"></div>
            </div>

            <!-- 20. å¿«é€Ÿæ¸¬è©¦æ‰€æœ‰ -->
            <div class="test-section" style="grid-column: 1 / -1;">
                <h2>
                    20. æ‰¹æ¬¡æ¸¬è©¦
                    <span class="category-badge badge-system">SYSTEM</span>
                </h2>
                <p style="font-size: 13px; color: #666; margin-top: 0;">ä¾åºæ¸¬è©¦åŸºæœ¬åŠŸèƒ½ (å¥åº·æª¢æŸ¥ â†’ Session â†’ ç­‰ç´šç³»çµ±)</p>
                <div class="button-group">
                    <button class="btn-primary" onclick="runBasicTests()">åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦</button>
                    <button class="btn-secondary" onclick="clearAllResults()">æ¸…é™¤æ‰€æœ‰çµæœ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä½¿ç”¨ Vite proxy,è®“è«‹æ±‚èµ°ä»£ç†
        const API_BASE = '';
        
        // çµ±è¨ˆ
        let stats = {
            tested: 0,
            success: 0,
            failed: 0
        };

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('stat-tested').textContent = stats.tested;
            document.getElementById('stat-success').textContent = stats.success;
            document.getElementById('stat-failed').textContent = stats.failed;
        }

        // æ›´æ–°ç‹€æ…‹æŒ‡ç¤ºå™¨
        function updateStatusIndicator(id, success) {
            const indicator = document.getElementById('status-' + id);
            if (indicator) {
                indicator.className = 'status-indicator ' + (success ? 'status-success' : 'status-error');
            }
        }

        // æ›´æ–°çµæœé¡¯ç¤º
        function updateResult(elementId, result, isSuccess = null) {
            const element = document.getElementById(elementId);
            const statusId = elementId.replace('-result', '');
            
            let className = 'result-box ';
            if (isSuccess === true) {
                className += 'result-success';
                stats.success++;
                updateStatusIndicator(statusId, true);
            } else if (isSuccess === false) {
                className += 'result-error';
                stats.failed++;
                updateStatusIndicator(statusId, false);
            } else if (isSuccess === 'pending') {
                className += 'result-pending';
            } else {
                className += 'result-info';
            }
            
            stats.tested++;
            updateStats();
            
            element.className = className;
            element.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

        // API è«‹æ±‚å°è£
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            try {
                const response = await fetch(url, {
                    ...options,
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                let data = {};
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json().catch(() => ({}));
                } else {
                    const text = await response.text();
                    data = { rawText: text || '(ç„¡å…§å®¹)', contentType };
                }

                return {
                    status: response.status,
                    ok: response.ok,
                    statusText: response.statusText,
                    data: data,
                    headers: Object.fromEntries(response.headers.entries())
                };
            } catch (error) {
                return {
                    status: 0,
                    ok: false,
                    error: error.message,
                    statusText: 'Network Error'
                };
            }
        }

        // 1. å¥åº·æª¢æŸ¥
        async function testHealth() {
            updateResult('health-result', { status: 'æ¸¬è©¦ä¸­...' }, 'pending');
            const result = await apiRequest('/health');
            updateResult('health-result', result, result.ok);
        }

        // 2. Session ç‹€æ…‹
        async function testSession() {
            updateResult('session-result', { status: 'æ¸¬è©¦ä¸­...' }, 'pending');
            const result = await apiRequest('/api/auth/session');
            updateResult('session-result', result, result.ok);
        }

        // 3. è¨»å†Š
        async function testRegister() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const name = document.getElementById('register-name').value;

            if (!email || !password || !name) {
                updateResult('register-result', { error: 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½' }, false);
                return;
            }

            updateResult('register-result', { status: 'è¨»å†Šä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/register', {
                method: 'POST',
                body: JSON.stringify({ email, password, name })
            });

            updateResult('register-result', result, result.status === 201 || result.status === 200);
        }

        // 4. ç™»å…¥
        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                updateResult('login-result', { error: 'è«‹å¡«å¯«Emailå’Œå¯†ç¢¼' }, false);
                return;
            }

            updateResult('login-result', { status: 'ç™»å…¥ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });

            updateResult('login-result', result, result.ok);
        }

        // 5. é©—è­‰ç‹€æ…‹
        async function testVerificationStatus() {
            updateResult('verify-status-result', { status: 'æŸ¥è©¢ä¸­...' }, 'pending');
            const result = await apiRequest('/api/auth/verification-status');
            updateResult('verify-status-result', result, result.ok);
        }

        // 6. ç™¼é€é©—è­‰ç¢¼
        async function testSendVerification() {
            updateResult('send-verify-result', { status: 'ç™¼é€ä¸­...' }, 'pending');
            const result = await apiRequest('/api/auth/send-verification', {
                method: 'POST'
            });
            updateResult('send-verify-result', result, result.ok);
        }

        // 7. é©—è­‰éƒµç®±
        async function testVerifyEmail() {
            const code = document.getElementById('verify-code').value;

            if (!code || code.length !== 6) {
                updateResult('verify-email-result', { error: 'è«‹è¼¸å…¥6ä½æ•¸é©—è­‰ç¢¼' }, false);
                return;
            }

            updateResult('verify-email-result', { status: 'é©—è­‰ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/verify-email', {
                method: 'POST',
                body: JSON.stringify({ code })
            });

            updateResult('verify-email-result', result, result.ok);
        }

        // 8. æœƒå“¡è³‡æ–™
        async function testMemberProfile() {
            const memberId = document.getElementById('member-id').value;

            if (!memberId) {
                updateResult('member-result', { error: 'è«‹è¼¸å…¥æœƒå“¡ID' }, false);
                return;
            }

            updateResult('member-result', { status: 'è¼‰å…¥ä¸­...' }, 'pending');

            const result = await apiRequest(`/api/members/${memberId}/profile`);
            updateResult('member-result', result, result.ok);
        }

        // 9. è¿½è¹¤æœƒå“¡
        async function testFollowMember() {
            const memberId = document.getElementById('follow-member-id').value;

            if (!memberId) {
                updateResult('follow-result', { error: 'è«‹è¼¸å…¥æœƒå“¡ID' }, false);
                return;
            }

            updateResult('follow-result', { status: 'è¿½è¹¤ä¸­...' }, 'pending');

            const result = await apiRequest(`/api/members/${memberId}/follow`, {
                method: 'POST'
            });

            updateResult('follow-result', result, result.status === 204 || result.ok);
        }

        // å–æ¶ˆè¿½è¹¤
        async function testUnfollowMember() {
            const memberId = document.getElementById('follow-member-id').value;

            if (!memberId) {
                updateResult('follow-result', { error: 'è«‹è¼¸å…¥æœƒå“¡ID' }, false);
                return;
            }

            updateResult('follow-result', { status: 'å–æ¶ˆè¿½è¹¤ä¸­...' }, 'pending');

            const result = await apiRequest(`/api/members/${memberId}/follow`, {
                method: 'DELETE'
            });

            updateResult('follow-result', result, result.status === 204 || result.ok);
        }

        // 10. ç­‰ç´šåˆ—è¡¨
        async function testLevels() {
            updateResult('levels-result', { status: 'è¼‰å…¥ä¸­...' }, 'pending');
            const result = await apiRequest('/levels');
            updateResult('levels-result', result, result.ok);
        }

        // 11. ç­‰ç´šçµ±è¨ˆ
        async function testLevelStats() {
            updateResult('level-stats-result', { status: 'è¼‰å…¥ä¸­...' }, 'pending');
            const result = await apiRequest('/levels/stats');
            updateResult('level-stats-result', result, result.ok);
        }

        // 12. å¯†ç¢¼éæœŸç‹€æ…‹
        async function testPasswordExpiry() {
            updateResult('pwd-expiry-result', { status: 'æŸ¥è©¢ä¸­...' }, 'pending');
            const result = await apiRequest('/api/auth/password-expiry-status');
            updateResult('pwd-expiry-result', result, result.ok);
        }

        // 13. ä¿®æ”¹å¯†ç¢¼
        async function testChangePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;

            if (!currentPassword || !newPassword) {
                updateResult('change-pwd-result', { error: 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½' }, false);
                return;
            }

            updateResult('change-pwd-result', { status: 'ä¿®æ”¹ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/change-password', {
                method: 'POST',
                body: JSON.stringify({ currentPassword, newPassword })
            });

            updateResult('change-pwd-result', result, result.ok);
        }

        // 14. å¿˜è¨˜å¯†ç¢¼
        async function testForgotPassword() {
            const email = document.getElementById('forgot-email').value;

            if (!email) {
                updateResult('forgot-pwd-result', { error: 'è«‹è¼¸å…¥Email' }, false);
                return;
            }

            updateResult('forgot-pwd-result', { status: 'ç™¼é€ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/forgot-password', {
                method: 'POST',
                body: JSON.stringify({ email })
            });

            updateResult('forgot-pwd-result', result, result.ok);
        }

        // 15. é©—è­‰é‡è¨­Token
        async function testVerifyResetToken() {
            const token = document.getElementById('reset-token').value;

            if (!token) {
                updateResult('verify-token-result', { error: 'è«‹è¼¸å…¥Token' }, false);
                return;
            }

            updateResult('verify-token-result', { status: 'é©—è­‰ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/verify-reset-token', {
                method: 'POST',
                body: JSON.stringify({ token })
            });

            updateResult('verify-token-result', result, result.ok);
        }

        // 16. é‡è¨­å¯†ç¢¼
        async function testResetPassword() {
            const token = document.getElementById('reset-pwd-token').value;
            const newPassword = document.getElementById('reset-new-password').value;

            if (!token || !newPassword) {
                updateResult('reset-pwd-result', { error: 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½' }, false);
                return;
            }

            updateResult('reset-pwd-result', { status: 'é‡è¨­ä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/reset-password', {
                method: 'POST',
                body: JSON.stringify({ token, newPassword })
            });

            updateResult('reset-pwd-result', result, result.ok);
        }

        // 17. é ­åƒä¸Šå‚³
        document.getElementById('avatar-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('avatar-filename').textContent = `å·²é¸æ“‡: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            }
        });

        async function testUploadAvatar() {
            const fileInput = document.getElementById('avatar-file');
            const file = fileInput.files[0];

            if (!file) {
                updateResult('avatar-result', { error: 'è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ' }, false);
                return;
            }

            updateResult('avatar-result', { status: 'ä¸Šå‚³ä¸­...' }, 'pending');

            const formData = new FormData();
            formData.append('avatar', file);

            try {
                const response = await fetch(`${API_BASE}/api/me/avatar`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                let data = {};
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                }

                const result = {
                    status: response.status,
                    ok: response.ok,
                    data: data
                };

                updateResult('avatar-result', result, result.ok);
            } catch (error) {
                updateResult('avatar-result', { error: error.message }, false);
            }
        }

        // 18. Google OAuth
        function testGoogleOAuth() {
            const redirectUrl = encodeURIComponent('/member');
            window.location.href = `${API_BASE}/api/auth/oauth/google/start?redirectUrl=${redirectUrl}`;
        }

        // 19. ç™»å‡º
        async function testLogout() {
            updateResult('logout-result', { status: 'ç™»å‡ºä¸­...' }, 'pending');

            const result = await apiRequest('/api/auth/logout', {
                method: 'POST'
            });

            updateResult('logout-result', result, result.status === 204 || result.ok);
        }

        // æ‰¹æ¬¡æ¸¬è©¦
        async function runBasicTests() {
            await testHealth();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testSession();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testLevels();
        }

        // æ¸…é™¤æ‰€æœ‰çµæœ
        function clearAllResults() {
            const results = document.querySelectorAll('[id$="-result"]');
            results.forEach(el => {
                el.innerHTML = '';
                el.className = '';
            });
            
            const indicators = document.querySelectorAll('.status-indicator');
            indicators.forEach(el => {
                el.className = 'status-indicator';
            });
            
            stats = { tested: 0, success: 0, failed: 0 };
            updateStats();
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦å¥åº·æª¢æŸ¥
        window.onload = function() {
            setTimeout(() => {
                testHealth();
            }, 500);
        };
    </script>
</body>
</html>
