# SGame API 測試指南

## 測試頁面位置

測試頁面: `http://localhost:5175/test-login.html`

## 測試前準備

1. **確認後端服務運行**
   - 後端地址: `https://10.2.0.2:8080`
   - 前端已配置 Vite proxy,所有 `/api` 請求會自動轉發到後端

2. **準備測試用 Email**
   - 需要一個真實的 Email 地址用於接收驗證碼
   - 建議使用個人測試郵箱 (Gmail, Outlook 等)

## 完整測試流程

### 階段一: 基礎連接測試

1. **健康檢查** (必須先通過)
   - 點擊「測試健康檢查」按鈕
   - 確認顯示綠色成功狀態
   - 預期響應: `{ status: "healthy", ... }`

2. **Session 狀態**
   - 點擊「檢查 Session」按鈕
   - 首次測試應該顯示未登入狀態
   - 預期響應: `{ loggedIn: false }`

3. **等級系統**
   - 點擊「獲取等級」按鈕
   - 確認可以取得所有等級資料
   - 點擊「獲取統計」按鈕查看等級統計

### 階段二: 註冊與登入

4. **註冊新帳號**
   - 填寫 Email (請使用真實郵箱)
   - 填寫密碼 (必須符合規則: 8-12碼,含大小寫+數字+特殊符號)
     - 範例: `Abcd1234!`
   - 填寫名稱 (任意)
   - 點擊「註冊」按鈕
   - 預期響應: `{ success: true, needsVerification: true }`

5. **登入系統**
   - 使用剛註冊的 Email 和密碼
   - 點擊「登入」按鈕
   - 預期響應: `{ success: true, token: "..." }`
   - 登入成功後 Cookie 會自動設置

6. **檢查 Session** (再次測試)
   - 點擊「檢查 Session」按鈕
   - 確認現在顯示已登入狀態
   - 預期響應: `{ loggedIn: true, userId: ..., email: "..." }`

### 階段三: 郵箱驗證

7. **查詢驗證狀態**
   - 點擊「查詢驗證狀態」按鈕
   - 確認顯示未驗證狀態
   - 預期響應: `{ isVerified: false }`

8. **發送驗證碼**
   - 點擊「發送驗證碼」按鈕
   - 檢查 Email 收件匣,找到 6 位數驗證碼
   - 預期響應: `{ success: true, message: "驗證碼已發送..." }`

9. **驗證郵箱**
   - 將收到的 6 位數驗證碼填入欄位
   - 點擊「提交驗證」按鈕
   - 預期響應: `{ success: true, message: "郵箱驗證成功" }`

10. **再次查詢驗證狀態**
    - 確認現在顯示已驗證
    - 預期響應: `{ isVerified: true }`

### 階段四: 會員功能

11. **查詢會員資料**
    - 輸入會員 ID (可以使用自己的 ID,從 Session 中取得)
    - 點擊「查詢會員」按鈕
    - 預期響應: 完整的會員資料,包含等級、頭像等

12. **追蹤功能** (需要兩個帳號)
    - 輸入另一個會員的 ID
    - 點擊「追蹤」按鈕
    - 預期響應: `204 No Content` (成功)
    - 點擊「取消追蹤」按鈕
    - 預期響應: `204 No Content` (成功)

13. **頭像上傳**
    - 點擊上傳區域選擇圖片
    - 支援格式: JPEG, PNG, WebP
    - 最大大小: 5MB
    - 點擊「上傳頭像」按鈕
    - 預期響應: `{ success: true, url: "/uploads/avatars/..." }`

### 階段五: 密碼管理

14. **查詢密碼過期狀態**
    - 點擊「查詢狀態」按鈕
    - 預期響應: 顯示密碼距離過期的天數

15. **修改密碼** (謹慎測試)
    - 輸入目前密碼
    - 輸入新密碼 (符合規則)
    - 點擊「修改密碼」按鈕
    - ⚠️ 注意: 修改後需要使用新密碼重新登入

16. **忘記密碼流程**
    - 輸入註冊的 Email
    - 點擊「發送重設郵件」按鈕
    - 檢查 Email 收件匣,找到重設連結中的 token
    - 預期響應: `{ success: true, message: "密碼重設郵件已發送..." }`

17. **驗證重設 Token**
    - 將從郵件中取得的 token 填入欄位
    - 點擊「驗證 Token」按鈕
    - 預期響應: `{ valid: true }`

18. **重設密碼**
    - 輸入重設 Token
    - 輸入新密碼
    - 點擊「重設密碼」按鈕
    - 預期響應: `{ success: true, message: "密碼重設成功..." }`

### 階段六: OAuth 與登出

19. **Google OAuth** (選測)
    - 點擊「Google 登入」按鈕
    - 會跳轉到 Google 授權頁面
    - 授權後會自動登入並返回

20. **登出**
    - 點擊「登出」按鈕
    - 預期響應: `204 No Content` (成功)
    - 再次檢查 Session,確認已登出

## 統計資訊說明

測試頁面頂部會顯示統計資訊:
- **總API數**: 21 個 API 端點
- **已測試**: 已執行測試的端點數量
- **成功**: 測試成功的數量
- **失敗**: 測試失敗的數量

每個測試區塊左側的圓點會顯示狀態:
- 🟢 綠色: 測試成功
- 🔴 紅色: 測試失敗
- ⚪ 無色: 尚未測試

## 常見問題排除

### 1. 健康檢查失敗
- 檢查後端服務是否運行: `https://10.2.0.2:8080`
- 檢查前端開發服務器是否運行: `npm run dev`
- 檢查 Vite proxy 配置是否正確

### 2. CORS 錯誤
- 確認前端使用 `credentials: 'include'`
- 確認後端 CORS 設定允許前端域名

### 3. 401 未授權
- 確認已經登入
- 檢查 Cookie 是否正確設置
- 嘗試重新登入

### 4. 429 請求過多
- 等待一段時間後再試
- 開發環境已禁用限流,如遇到請檢查環境配置

### 5. 郵件收不到
- 檢查垃圾郵件資料夾
- 確認後端 Email 服務配置正確
- 查看後端日誌確認郵件是否發送

## 測試完成檢查清單

- [ ] 健康檢查成功
- [ ] Session 狀態查詢成功
- [ ] 註冊新帳號成功
- [ ] 登入系統成功
- [ ] 郵箱驗證流程完整測試
- [ ] 會員資料查詢成功
- [ ] 追蹤/取消追蹤功能正常
- [ ] 等級系統資料正常
- [ ] 密碼過期狀態查詢成功
- [ ] 頭像上傳成功 (選測)
- [ ] 密碼管理功能正常 (選測)
- [ ] 登出成功

## 下一步

當所有測試通過後,請通知開發團隊,我們將進入**階段二: 整合到 Vue 頁面**。

---

**測試完成後請截圖保存測試結果,特別是統計資訊和關鍵 API 的響應內容。**



