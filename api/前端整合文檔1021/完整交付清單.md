# SGame API 前端交付完整清單

**交付日期**: 2025-10-21  
**API版本**: v1.0.2  
**狀態**: ✅ 生產就緒

---

## 📦 交付內容

### 1. API端點（已測試通過）

#### 認證API（14個端點）✅
- ✅ POST /auth/register - 註冊
- ✅ POST /auth/login - 登入
- ✅ GET /auth/session - Session狀態
- ✅ POST /auth/logout - 登出
- ✅ POST /auth/send-verification - 發送驗證碼
- ✅ POST /auth/verify-email - 驗證郵箱
- ✅ GET /auth/verification-status - 驗證狀態
- ✅ POST /auth/forgot-password - 忘記密碼
- ✅ POST /auth/verify-reset-token - 驗證重設token
- ✅ POST /auth/reset-password - 重設密碼
- ✅ POST /auth/change-password - 修改密碼
- ✅ GET /auth/password-expiry-status - 密碼過期狀態
- ✅ GET /auth/oauth/google/start - Google OAuth啟動
- ✅ GET /auth/oauth/google/callback - Google OAuth回調

#### 會員API（6個端點）✅
- ✅ GET /members/{id}/profile - 會員資料
- ✅ POST /members/{id}/follow - 追蹤會員
- ✅ DELETE /members/{id}/follow - 取消追蹤
- ✅ GET /levels - 等級列表
- ✅ GET /levels/stats - 等級統計
- ✅ POST /me/avatar - 上傳頭像

#### 核心API（1個端點）✅
- ✅ GET /health - 健康檢查

**總計**: 21個API端點，全部測試通過！

### 2. 文檔

#### 核心文檔
- ✅ `README.md` - 文檔導航
- ✅ `01-API總覽.md` - API基礎資訊
- ✅ `API-Check.md` - 完整端點清單
- ✅ `openapi.yaml` - OpenAPI規格

#### 詳細文檔（可參考）
- 📄 `最終測試報告.md` - 完整測試結果
- 📄 `後端測試報告-2025-10-21.md` - 詳細測試數據
- 📄 `頭像上傳功能實作報告.md` - 頭像上傳詳情
- 📄 `頭像上傳-快速參考.md` - 頭像上傳快速指南
- 📄 `Email功能說明.md` - Email功能配置
- 📄 `登入功能修復報告.md` - 登入問題修復記錄

#### 測試腳本
- 📜 `test-api-full.sh` - 完整API測試
- 📜 `test-email-verification-complete.sh` - 郵箱驗證測試
- 📜 `test-password-reset-complete.sh` - 密碼重設測試
- 📜 `test-member-follow-complete.sh` - 會員追蹤測試
- 📜 `test-avatar-upload.sh` - 頭像上傳測試
- 📜 `test-login-function.sh` - 登入功能測試

### 3. 測試結果

#### 測試統計
- ✅ 測試通過率: **100%** (21/21)
- ✅ API穩定性: 優秀（無崩潰）
- ✅ 平均響應時間: <100ms
- ✅ Email功能: 已驗證工作

#### 測試證據
- 所有端點都有對應的curl測試腳本
- 測試日誌記錄在各測試報告中
- 實際郵件發送測試通過

---

## 🚀 開始整合

### 步驟1: 環境配置

#### 前端配置
```env
# .env.development
VITE_API_BASE_URL=https://10.2.0.2:8080/api
VITE_FRONTEND_URL=http://localhost:3000
```

#### 重要提醒
1. 所有請求必須設置 `credentials: 'include'`
2. 使用HTTPS（開發環境需處理自簽證書）
3. CORS已配置允許 `10.1.0.0/24` 網段

### 步驟2: 創建API Client

```javascript
// src/api/client.js
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  withCredentials: true,  // 重要！
  headers: {
    'Content-Type': 'application/json'
  }
});

// 響應攔截器
api.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // 跳轉登入頁
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

### 步驟3: 實作認證

```javascript
// src/api/auth.js
import api from './client';

export const authAPI = {
  // 登入
  login: (email, password) => 
    api.post('/auth/login', { email, password }),
  
  // 註冊
  register: (email, password, name) =>
    api.post('/auth/register', { email, password, name }),
  
  // 檢查Session
  getSession: () => 
    api.get('/auth/session'),
  
  // 登出
  logout: () => 
    api.post('/auth/logout')
};
```

### 步驟4: 測試連接

```javascript
// 測試健康檢查
fetch('https://10.2.0.2:8080/health')
  .then(res => res.json())
  .then(data => {
    if (data.status === 'healthy') {
      console.log('✅ API連接正常');
    }
  });
```

---

## 📚 完整API文檔

### 認證API

#### 註冊
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "Pass1234!",
  "name": "User Name"
}

Response 201:
{
  "success": true,
  "message": "註冊成功，請檢查郵箱並完成驗證",
  "redirectUrl": "/login",
  "needsVerification": true
}
```

#### 登入
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "Pass1234!"
}

Response 200:
{
  "success": true,
  "message": "登入成功",
  "token": "eyJhbGc...",
  "passwordExpiry": {
    "isExpired": false,
    "isWarning": false,
    "daysUntilExpiry": 180,
    "message": "您的密碼狀態正常，距離過期還有 180 天"
  }
}

Set-Cookie: sgame_session=session:123; HttpOnly; Max-Age=604800
```

#### Session狀態
```http
GET /api/auth/session
Cookie: sgame_session=session:123

Response 200:
{
  "success": true,
  "loggedIn": true,
  "userId": 123,
  "email": "user@example.com",
  "name": "User Name",
  "emailVerified": true,
  "passwordExpiry": { ... }
}
```

#### 登出
```http
POST /api/auth/logout
Cookie: sgame_session=session:123

Response 204: (無內容)
```

#### 忘記密碼
```http
POST /api/auth/forgot-password
Content-Type: application/json

{
  "email": "user@example.com"
}

Response 200:
{
  "success": true,
  "message": "密碼重設郵件已發送至您的郵箱，請在 24 小時內完成重設"
}
```

#### 重設密碼
```http
POST /api/auth/reset-password
Content-Type: application/json

{
  "token": "reset-token-from-email",
  "newPassword": "NewPass1234!"
}

Response 200:
{
  "success": true,
  "message": "密碼重設成功，請使用新密碼登入"
}
```

### 會員API

#### 獲取會員資料
```http
GET /api/members/123/profile
Cookie: sgame_session=session:456

Response 200:
{
  "success": true,
  "profile": {
    "id": 123,
    "email": "user@example.com",
    "name": "User Name",
    "avatarUrl": "/uploads/avatars/123-1234567890.jpg",
    "emailVerified": true,
    "level": "bronze",
    "score": 500,
    "followersCount": 10,
    "followingCount": 5,
    "levelInfo": {
      "code": "bronze",
      "name": "青銅",
      "color": "#CD7F32",
      "icon": "🥉",
      "minScore": 0,
      "maxScore": 999
    }
  },
  "relationships": {
    "isSelf": false,
    "isFollowing": false,
    "isMutual": false
  }
}
```

#### 追蹤會員
```http
POST /api/members/123/follow
Cookie: sgame_session=session:456

Response 204: (無內容)
```

#### 上傳頭像
```http
POST /api/me/avatar
Content-Type: multipart/form-data
Cookie: sgame_session=session:123

------WebKitFormBoundary
Content-Disposition: form-data; name="avatar"; filename="avatar.jpg"
Content-Type: image/jpeg

<binary data>
------WebKitFormBoundary--

Response 200:
{
  "success": true,
  "url": "/uploads/avatars/123-1234567890.jpg",
  "updatedAt": "2025-10-21T08:00:00.000Z"
}
```

---

## 🔐 密碼規則

- **長度**: 8-12字元
- **必須包含**: 大寫字母、小寫字母、數字、特殊符號
- **不可包含**: 空白
- **過期**: 180天（7天前開始警告）

---

## ⚠️ 重要提醒

### FRONTEND_URL配置

**當前值**: `https://34.80.46.175:5175`

郵件中的重設連結會使用這個URL，請確保：
1. 前端實作 `/reset-password` 頁面
2. URL可以從外網訪問
3. 生產環境更新為實際域名

### HTTPS自簽證書

開發環境使用自簽證書，前端需要：
1. 瀏覽器信任證書，或
2. 使用代理伺服器，或
3. 開發時忽略SSL錯誤（不推薦生產環境）

### Cookie跨域

所有請求必須設置 `credentials: 'include'` 或 `withCredentials: true`

---

## 📞 技術支援

### 查閱資源
1. **測試報告**: `api文檔/最終測試報告.md`
2. **OpenAPI規格**: `api文檔/openapi.yaml`
3. **測試腳本**: `test-*.sh` 文件

### 常見問題
- CORS問題: 檢查 `credentials: 'include'`
- 401錯誤: 未登入或Session過期
- Cookie未設置: 檢查 `withCredentials`配置

---

## ✅ 測試建議

1. 先測試 `/health` 端點確認連接
2. 測試註冊和登入流程
3. 測試Session狀態查詢
4. 測試需要認證的端點
5. 測試錯誤處理

---

## 🎉 準備就緒

所有API端點已測試通過，可以開始前端整合！

**祝開發順利！** 🚀

