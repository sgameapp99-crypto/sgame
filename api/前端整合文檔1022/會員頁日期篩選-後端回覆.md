# æœƒå“¡é æ—¥æœŸç¯©é¸åŠŸèƒ½ - å¾Œç«¯å¯¦ä½œå®Œæˆå›è¦†

**æ—¥æœŸ**: 2025å¹´10æœˆ22æ—¥  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦æ¸¬è©¦**

---

## ğŸ“‹ å¯¦ä½œæ¦‚è¦

å¾Œç«¯å·²æŒ‰ç…§å‰ç«¯éœ€æ±‚æ–‡ä»¶å¯¦ä½œ `startDate` å’Œ `endDate` åƒæ•¸æ”¯æ´ï¼Œå…è¨±æœƒå“¡é é¢é€²è¡Œéˆæ´»çš„æ—¥æœŸç¯„åœç¯©é¸ã€‚

---

## âœ… å·²å¯¦ä½œåŠŸèƒ½

### æ–°å¢åƒæ•¸

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ | ç¯„ä¾‹å€¼ |
|--------|------|------|------|--------|
| `startDate` | string | å¦ | é–‹å§‹æ—¥æœŸï¼ˆYYYY-MM-DD æ ¼å¼ï¼‰ | `"2025-10-22"` |
| `endDate` | string | å¦ | çµæŸæ—¥æœŸï¼ˆYYYY-MM-DD æ ¼å¼ï¼‰ | `"2025-10-29"` |

### æ—¥æœŸç¯©é¸é‚è¼¯

```typescript
// 1. å…©è€…éƒ½æä¾›ï¼šè¿”å› startDate <= gameDate <= endDate çš„é æ¸¬
GET /api/predictions?memberId=123&startDate=2025-10-22&endDate=2025-10-29

// 2. åªæä¾› startDateï¼šè¿”å› gameDate >= startDate çš„æ‰€æœ‰é æ¸¬ï¼ˆå…¨éƒ¨æœªä¾†ï¼‰
GET /api/predictions?memberId=123&startDate=2025-10-22

// 3. åªæä¾› endDateï¼šè¿”å› gameDate <= endDate çš„æ‰€æœ‰é æ¸¬
GET /api/predictions?memberId=123&endDate=2025-10-29
```

### å‘å¾Œå…¼å®¹æ€§

âœ… ä¿ç•™äº†åŸæœ‰çš„ `dateRange` åƒæ•¸ï¼ˆ`today`, `week`, `month`, `all`ï¼‰
âœ… æ–°èˆŠåƒæ•¸å¯ä»¥å…±å­˜ï¼Œå„ªå…ˆä½¿ç”¨ `startDate`/`endDate`

---

## âš ï¸ é‡è¦ï¼šåƒæ•¸åç¨±èªªæ˜

### ä½¿ç”¨ `memberId` è€Œé `userId`

ç‚ºäº†èˆ‡ç¾æœ‰ API ä¿æŒä¸€è‡´æ€§ï¼Œ**é æ¸¬åˆ—è¡¨ API ä½¿ç”¨ `memberId` ä½œç‚ºç”¨æˆ¶ç¯©é¸åƒæ•¸**ã€‚

**åŸå› **ï¼š
1. ç¾æœ‰ç³»çµ±ä¸­ï¼Œ`userId` é€šå¸¸è¡¨ç¤ºç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼ˆå¾ session/token å–å¾—ï¼‰
2. `memberId` è¡¨ç¤ºè¦æŸ¥è©¢çš„ç›®æ¨™æœƒå“¡ IDï¼ˆå¯èƒ½æ˜¯è‡ªå·±æˆ–å…¶ä»–æœƒå“¡ï¼‰
3. é€™æ¨£çš„å‘½åé¿å…äº†é‚è¼¯ä¸Šçš„æ··æ·†

**å‰ç«¯éœ€è¦èª¿æ•´**ï¼š

```diff
# å‰ç«¯éœ€æ±‚æ–‡ä»¶ä¸­çš„ç¯„ä¾‹
- GET /api/predictions?userId=user123&startDate=2025-10-22
+ GET /api/predictions?memberId=123&startDate=2025-10-22
```

**å¯¦éš›ä½¿ç”¨å ´æ™¯**ï¼š

```javascript
// æŸ¥è©¢ç•¶å‰ç”¨æˆ¶è‡ªå·±çš„é æ¸¬
const myPredictions = await api.get('/api/predictions', {
  params: {
    memberId: currentUser.id,  // ä½¿ç”¨ memberIdï¼Œä¸æ˜¯ userId
    startDate: '2025-10-22',
    endDate: '2025-10-29'
  }
});

// æŸ¥è©¢å…¶ä»–æœƒå“¡çš„é æ¸¬ï¼ˆå¦‚æœæœ‰æ¬Šé™ï¼‰
const otherPredictions = await api.get('/api/predictions', {
  params: {
    memberId: 456,  // æŸ¥è©¢å…¶ä»–æœƒå“¡
    startDate: '2025-10-22'
  }
});
```

---

## ğŸ“Š ä¸‰ç¨®ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šä¸€é€±å…§

**å‰ç«¯å‚³å…¥**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025-10-22&endDate=2025-10-29
```

**å¾Œç«¯è¡Œç‚º**ï¼š
- ç¯©é¸ `gameDate >= '2025-10-22' AND gameDate <= '2025-10-29'` çš„é æ¸¬
- è¿”å›ç¬¦åˆæ¢ä»¶çš„é æ¸¬åˆ—è¡¨

**å›æ‡‰ç¯„ä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "userId": 123,
      "userName": "å¼µä¸‰",
      "gameId": "20251024TEST007",
      "gameInfo": {
        "allianceId": 2,
        "allianceName": "NBA",
        "gameDate": "2025-10-24",
        "gameTime": "19:30",
        "homeTeam": "æ´›æ‰ç£¯æ¹–äºº",
        "awayTeam": "é‡‘å·å‹‡å£«"
      },
      "predictionType": "international_spread",
      "predictionTypeLabel": "åœ‹éš›ç›¤è®“åˆ†",
      "odds": "1.90",
      "price": 100,
      "status": "pending"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "total": 5
  }
}
```

### å ´æ™¯ 2ï¼šä¸€å€‹æœˆå…§

**å‰ç«¯å‚³å…¥**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025-10-22&endDate=2025-11-21
```

**å¾Œç«¯è¡Œç‚º**ï¼š
- ç¯©é¸ `gameDate >= '2025-10-22' AND gameDate <= '2025-11-21'` çš„é æ¸¬

### å ´æ™¯ 3ï¼šå…¨éƒ¨ï¼ˆæœ€é‡è¦ï¼‰â­

**å‰ç«¯å‚³å…¥**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025-10-22
```

**é—œéµ**ï¼šä¸å‚³ `endDate` åƒæ•¸

**å¾Œç«¯è¡Œç‚º**ï¼š
- ç¯©é¸ `gameDate >= '2025-10-22'` çš„æ‰€æœ‰é æ¸¬
- **ä¸é™åˆ¶çµæŸæ—¥æœŸ**ï¼Œè¿”å›æ‰€æœ‰æœªä¾†é æ¸¬

**é€™æ­£æ˜¯å‰ç«¯ã€Œå…¨éƒ¨ã€é¸é …éœ€è¦çš„è¡Œç‚º** âœ…

---

## ğŸ” éŒ¯èª¤è™•ç†

### 1. æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼ˆHTTP 400ï¼‰

**è«‹æ±‚**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025/10/22
```

**å›æ‡‰**ï¼š
```json
{
  "success": false,
  "message": "é–‹å§‹æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼Œè«‹ä½¿ç”¨ YYYY-MM-DD æ ¼å¼",
  "code": "INVALID_DATE_FORMAT"
}
```

### 2. æ—¥æœŸç¯„åœéŒ¯èª¤ï¼ˆHTTP 400ï¼‰

**è«‹æ±‚**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025-10-29&endDate=2025-10-22
```

**å›æ‡‰**ï¼š
```json
{
  "success": false,
  "message": "é–‹å§‹æ—¥æœŸä¸èƒ½å¤§æ–¼çµæŸæ—¥æœŸ",
  "code": "INVALID_DATE_RANGE"
}
```

### 3. ç„¡æ•¸æ“šï¼ˆHTTP 200ï¼‰

**è«‹æ±‚**ï¼š
```http
GET /api/predictions?memberId=123&startDate=2025-12-01&endDate=2025-12-31
```

**å›æ‡‰**ï¼š
```json
{
  "success": true,
  "data": [],
  "pagination": {
    "page": 1,
    "size": 20,
    "total": 0
  }
}
```

---

## ğŸ§ª æ¸¬è©¦ç¯„ä¾‹

### ä½¿ç”¨ curl æ¸¬è©¦

```bash
# 1. ç™»å…¥ç²å– cookie
curl -k -c cookies.txt -X POST https://10.2.0.2:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"testpred@example.com","password":"Pred1234!@#"}'

# 2. æ¸¬è©¦ä¸€é€±å…§
curl -k -b cookies.txt "https://10.2.0.2:8080/api/predictions?memberId=5&startDate=2025-10-22&endDate=2025-10-29"

# 3. æ¸¬è©¦å…¨éƒ¨ï¼ˆä¸å‚³ endDateï¼‰
curl -k -b cookies.txt "https://10.2.0.2:8080/api/predictions?memberId=5&startDate=2025-10-22"

# 4. æ¸¬è©¦æ—¥æœŸæ ¼å¼éŒ¯èª¤
curl -k -b cookies.txt "https://10.2.0.2:8080/api/predictions?memberId=5&startDate=2025/10/22"

# 5. æ¸¬è©¦æ—¥æœŸç¯„åœéŒ¯èª¤
curl -k -b cookies.txt "https://10.2.0.2:8080/api/predictions?memberId=5&startDate=2025-10-29&endDate=2025-10-22"
```

### ä½¿ç”¨ JavaScript/TypeScript

```typescript
// API æœå‹™å±¤
export const predictionsAPI = {
  async getPredictions(params: {
    memberId: number;      // ä½¿ç”¨ memberIdï¼Œä¸æ˜¯ userId
    startDate?: string;
    endDate?: string;
    allianceId?: number;
    page?: number;
    size?: number;
  }) {
    const response = await axios.get('/api/predictions', { params });
    return response.data;
  }
};

// ä½¿ç”¨ç¯„ä¾‹
// ä¸€é€±å…§
const weekData = await predictionsAPI.getPredictions({
  memberId: currentUser.id,
  startDate: '2025-10-22',
  endDate: '2025-10-29'
});

// å…¨éƒ¨
const allData = await predictionsAPI.getPredictions({
  memberId: currentUser.id,
  startDate: '2025-10-22'
  // ä¸å‚³ endDate
});
```

---

## ğŸ“‹ å®Œæ•´åƒæ•¸åˆ—è¡¨

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ | é è¨­å€¼ |
|--------|------|------|------|--------|
| `memberId` | number | å¦* | è¦æŸ¥è©¢çš„æœƒå“¡ ID | ç„¡ |
| `startDate` | string | å¦ | é–‹å§‹æ—¥æœŸ (YYYY-MM-DD) | ç„¡ |
| `endDate` | string | å¦ | çµæŸæ—¥æœŸ (YYYY-MM-DD) | ç„¡ |
| `allianceId` | number | å¦ | è¯ç›Ÿ ID | ç„¡ |
| `status` | string | å¦ | ç‹€æ…‹ (pending, win, lose, cancelled) | ç„¡ |
| `gameMode` | string | å¦ | ç›¤å£é¡å‹ (international, taiwan) | ç„¡ |
| `page` | number | å¦ | é ç¢¼ | 1 |
| `size` | number | å¦ | æ¯é ç­†æ•¸ | 20 |

*è¨»ï¼š`memberId` åœ¨æœƒå“¡é é¢é€šå¸¸æ˜¯å¿…å¡«çš„ï¼Œä½† API å±¤é¢ä¸å¼·åˆ¶

---

## ğŸ”„ çµåˆå…¶ä»–ç¯©é¸æ¢ä»¶

æ‰€æœ‰åƒæ•¸å¯ä»¥è‡ªç”±çµ„åˆï¼š

```http
# æŸ¥è©¢ç‰¹å®šè¯ç›Ÿ + æ—¥æœŸç¯„åœ
GET /api/predictions?memberId=123&allianceId=1&startDate=2025-10-22&endDate=2025-10-29

# æŸ¥è©¢ç‰¹å®šç‹€æ…‹ + æ—¥æœŸç¯„åœ
GET /api/predictions?memberId=123&status=pending&startDate=2025-10-22

# æŸ¥è©¢ç‰¹å®šç›¤å£é¡å‹ + æ—¥æœŸç¯„åœ
GET /api/predictions?memberId=123&gameMode=international&startDate=2025-10-22&endDate=2025-10-29
```

---

## âœ… é©—æ”¶ç¢ºèª

- [x] 1. API ç«¯é»å·²éƒ¨ç½²åˆ°æ¸¬è©¦ç’°å¢ƒï¼ˆhttps://10.2.0.2:8080ï¼‰
- [x] 2. æ¸¬è©¦ç’°å¢ƒå¯æ­£å¸¸è¨ªå•
- [x] 3. æ¸¬è©¦ç”¨ memberId: 5 (testpred@example.com)
- [x] 4. ä¸‰ç¨®å ´æ™¯ï¼ˆä¸€é€±å…§ã€ä¸€å€‹æœˆå…§ã€å…¨éƒ¨ï¼‰éƒ½èƒ½æ­£ç¢ºè¿”å›è³‡æ–™
- [x] 5. åˆ†é åŠŸèƒ½æ­£å¸¸
- [x] 6. éŒ¯èª¤è™•ç†ï¼ˆåƒæ•¸é©—è­‰ã€éŒ¯èª¤ç¢¼ï¼‰ç¬¦åˆæ–‡ä»¶è¦ç¯„

---

## ğŸ“ å‰ç«¯èª¿æ•´å»ºè­°

### å¿…é ˆèª¿æ•´

1. **åƒæ•¸åç¨±**ï¼šå°‡ `userId` æ”¹ç‚º `memberId`
   ```typescript
   // Before
   const params = { userId: currentUser.id, ... };
   
   // After
   const params = { memberId: currentUser.id, ... };
   ```

### å»ºè­°èª¿æ•´

2. **éŒ¯èª¤è™•ç†**ï¼šæ ¹æ“šè¿”å›çš„ `code` æ¬„ä½é¡¯ç¤ºå‹å–„æç¤º
   ```typescript
   if (!response.success) {
     switch (response.code) {
       case 'INVALID_DATE_FORMAT':
         showError('æ—¥æœŸæ ¼å¼éŒ¯èª¤');
         break;
       case 'INVALID_DATE_RANGE':
         showError('é–‹å§‹æ—¥æœŸä¸èƒ½å¤§æ–¼çµæŸæ—¥æœŸ');
         break;
     }
   }
   ```

---

## ğŸ’¡ è£œå……èªªæ˜

### æ™‚å€è™•ç†

- æ—¥æœŸæ ¼å¼ç‚º `YYYY-MM-DD`ï¼ˆä¸å«æ™‚é–“å’Œæ™‚å€ï¼‰
- å¾Œç«¯æŒ‰ç…§è³½äº‹ç•¶åœ°æ—¥æœŸé€²è¡Œæ¯”è¼ƒ
- å‰ç«¯å‚³å…¥çš„æ—¥æœŸæ‡‰è©²æ˜¯ç”¨æˆ¶ç•¶åœ°æ™‚å€çš„æ—¥æœŸ

### æ’åº

- é æ¸¬åˆ—è¡¨é è¨­æŒ‰ `createdAt` é™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
- å¯ä»¥è€ƒæ…®æœªä¾†æ–°å¢ `sortBy` å’Œ `sortOrder` åƒæ•¸

### æ•ˆèƒ½

- å·²åœ¨ `gameDate` æ¬„ä½ä¸Šå»ºç«‹ç´¢å¼•
- æ—¥æœŸç¯„åœæŸ¥è©¢æ•ˆèƒ½è‰¯å¥½
- å»ºè­°å‰ç«¯å¯¦ä½œè™›æ“¬æ»¾å‹•è™•ç†å¤§é‡æ•¸æ“š

---

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰ä»»ä½•ç–‘å•æˆ–éœ€è¦é€²ä¸€æ­¥èªªæ˜ï¼š

- **å¾Œç«¯è² è²¬äºº**: å¾Œç«¯åœ˜éšŠ
- **æ¸¬è©¦ç’°å¢ƒ**: https://10.2.0.2:8080
- **æ–‡æª”ä½ç½®**: `/apiæ–‡æª”/å‰ç«¯æ•´åˆæ–‡æª”1022/`

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [é æ¸¬ç³»çµ±ä½¿ç”¨èªªæ˜](./é æ¸¬ç³»çµ±ä½¿ç”¨èªªæ˜.md)
- [æ¸¬è©¦è³‡æ–™ä½¿ç”¨èªªæ˜](./æ¸¬è©¦è³‡æ–™ä½¿ç”¨èªªæ˜.md)
- [å¾Œç«¯ç¢ºèªå›è¦†](./å¾Œç«¯ç¢ºèªå›è¦†.md)
- [éŒ¯èª¤ä»£ç¢¼ä¿®å¾©å ±å‘Š](./éŒ¯èª¤ä»£ç¢¼ä¿®å¾©å ±å‘Š.md)

---

**å¯¦ä½œå®Œæˆæ—¥æœŸ**: 2025å¹´10æœˆ22æ—¥  
**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**ç‹€æ…‹**: âœ… å·²å®Œæˆä¸¦å¯ä¾›å‰ç«¯æ•´åˆ

