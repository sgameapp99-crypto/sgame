openapi: 3.1.0
info:
  title: SGame Member API
  version: 0.1.0
  description: |
    å‰å¾Œç«¯å”ä½œç”¨ API è¦æ ¼ï¼ˆå°å¤– REST + JSONï¼‰ã€‚
    - å°å¤–å‚³è¼¸æ ¼å¼ï¼šapplication/json
    - è¦æ ¼æ–‡ä»¶æ ¼å¼ï¼šOpenAPI (YAML)
servers:
  - url: https://10.2.0.2:8080
    description: Development (å…§ç¶²ç’°å¢ƒ)
  - url: https://api.example.com
    description: Production
  - url: https://staging-api.example.com
    description: Staging
tags:
  - name: system
    description: ç³»çµ±ç‹€æ…‹æª¢æŸ¥
  - name: auth
    description: èªè­‰
  - name: members
    description: æœƒå“¡è³‡æ–™/é é¢ä¸»é«”
  - name: me
    description: å€‹äººè¨­å®š/è³‡æ–™ç¶­è­·
  - name: filters
    description: ç¯©é¸/å­—å…¸è³‡æ–™
  - name: posts
    description: æœƒå“¡ç™¼æ–‡
  - name: levels
    description: æœƒå“¡ç­‰ç´šç³»çµ±

paths:
  /health:
    get:
      tags: [system]
      summary: å¥åº·æª¢æŸ¥
      description: æª¢æŸ¥APIæœå‹™ã€è³‡æ–™åº«å’ŒRedisé€£æ¥ç‹€æ…‹
      responses:
        '200':
          description: æœå‹™æ­£å¸¸é‹è¡Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  services:
                    type: object
                    properties:
                      database:
                        type: string
                        example: "connected"
                      redis:
                        type: string
                        example: "connected"

  /levels:
    get:
      tags: [levels]
      summary: ç²å–æ‰€æœ‰ç­‰ç´šè³‡è¨Š
      responses:
        '200':
          description: ç­‰ç´šè³‡è¨Šåˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  levels:
                    type: array
                    items:
                      type: object
                      properties:
                        code:
                          type: string
                          example: "bronze"
                        name:
                          type: string
                          example: "é’éŠ…"
                        nameEn:
                          type: string
                          example: "Bronze"
                        color:
                          type: string
                          example: "#CD7F32"
                        icon:
                          type: string
                          example: "ğŸ¥‰"
                        minScore:
                          type: number
                          example: 0
                        maxScore:
                          type: number
                          nullable: true
                          example: 999
                        description:
                          type: string
                          example: "æ–°æ‰‹ç­‰ç´š"
                        benefits:
                          type: array
                          items:
                            type: string
                          example: ["åŸºæœ¬æœƒå“¡åŠŸèƒ½", "æ¯æ—¥ç™»å…¥çå‹µ"]

  /levels/stats:
    get:
      tags: [levels]
      summary: ç²å–ç­‰ç´šçµ±è¨ˆè³‡è¨Š
      responses:
        '200':
          description: ç­‰ç´šçµ±è¨ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  stats:
                    type: object

  /auth/login:
    post:
      tags: [auth]
      summary: ä½¿ç”¨è€…ç™»å…¥
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
              required: [email, password]
      responses:
        '200':
          description: ç™»å…¥æˆåŠŸï¼ˆåŒæ™‚ä»¥ Set-Cookie ä¸‹ç™¼ HttpOnly æœƒè©±ï¼‰
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ç™»å…¥æˆåŠŸ"
                  token:
                    type: string
                    description: JWT Bearer Token
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  passwordExpiry:
                    $ref: '#/components/schemas/PasswordExpiryInfo'
        '204':
          description: ç™»å…¥æˆåŠŸï¼ˆç„¡å›æ‡‰å…§å®¹ï¼›ä»¥ Set-Cookie ä¸‹ç™¼ HttpOnly æœƒè©±ï¼‰
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      tags: [auth]
      summary: ä½¿ç”¨è€…è¨»å†Šï¼ˆEmail/Passwordï¼‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                name:
                  type: string
              required: [email, password, name]
      responses:
        '201':
          description: è¨»å†ŠæˆåŠŸï¼ˆéœ€è¦éƒµç®±é©—è­‰ï¼‰
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    description: è¨»å†ŠæˆåŠŸè¨Šæ¯
                    example: "è¨»å†ŠæˆåŠŸï¼Œè«‹æª¢æŸ¥éƒµç®±ä¸¦å®Œæˆé©—è­‰"
                  redirectUrl:
                    type: string
                    description: è¨»å†Šå¾Œå°å›è·¯å¾‘
                    example: "/login"
                  needsVerification:
                    type: boolean
                    description: æ˜¯å¦éœ€è¦éƒµç®±é©—è­‰
                    default: true
                    example: true
        '409':
          description: Email å·²è¢«ä½¿ç”¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ErrorResponse'
                  - $ref: '#/components/schemas/PasswordWeakError'

  /auth/send-verification:
    post:
      tags: [auth]
      summary: ç™¼é€éƒµç®±é©—è­‰ç¢¼
      description: å‘ç”¨æˆ¶éƒµç®±ç™¼é€ 6 ä½æ•¸é©—è­‰ç¢¼
      security:
        - bearerAuth: []
      responses:
        '200':
          description: é©—è­‰ç¢¼ç™¼é€æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          description: ç™¼é€å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/verify-email:
    post:
      tags: [auth]
      summary: é©—è­‰éƒµç®±é©—è­‰ç¢¼
      description: ä½¿ç”¨ 6 ä½æ•¸é©—è­‰ç¢¼é©—è­‰ç”¨æˆ¶éƒµç®±
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  pattern: '^[0-9]{6}$'
                  description: 6ä½æ•¸é©—è­‰ç¢¼
              required: [code]
      responses:
        '200':
          description: é©—è­‰æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationResponse'
        '400':
          description: é©—è­‰å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailVerificationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Note: /auth/resend-verification endpoint has been removed
  # Use /auth/send-verification for both initial send and resend
  # The service automatically handles cooldown periods (60 seconds)

  /auth/verification-status:
    get:
      tags: [auth]
      summary: æª¢æŸ¥é©—è­‰ç‹€æ…‹
      description: ç²å–ç”¨æˆ¶éƒµç®±é©—è­‰ç‹€æ…‹
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ç²å–é©—è­‰ç‹€æ…‹æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerificationStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/forgot-password:
    post:
      tags: [auth]
      summary: å¿˜è¨˜å¯†ç¢¼ - ç™¼é€é‡è¨­éƒµä»¶
      description: å‘ç”¨æˆ¶éƒµç®±ç™¼é€å¯†ç¢¼é‡è¨­éƒµä»¶
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  description: ç”¨æˆ¶éƒµç®±
              required: [email]
      responses:
        '200':
          description: é‡è¨­éƒµä»¶ç™¼é€æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: ç™¼é€å¤±æ•—æˆ–å¸³è™Ÿå•é¡Œ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/verify-reset-token:
    post:
      tags: [auth]
      summary: é©—è­‰å¯†ç¢¼é‡è¨­ä»¤ç‰Œ
      description: é©—è­‰å¾éƒµä»¶ä¸­ç²å¾—çš„é‡è¨­ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: é‡è¨­ä»¤ç‰Œ
              required: [token]
      responses:
        '200':
          description: ä»¤ç‰Œé©—è­‰çµæœ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenVerificationResponse'
        '400':
          description: ä»¤ç‰Œç„¡æ•ˆæˆ–å·²éæœŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenVerificationResponse'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password:
    post:
      tags: [auth]
      summary: é‡è¨­å¯†ç¢¼
      description: ä½¿ç”¨é‡è¨­ä»¤ç‰Œè¨­å®šæ–°å¯†ç¢¼
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: é‡è¨­ä»¤ç‰Œ
                newPassword:
                  type: string
                  minLength: 8
                  description: æ–°å¯†ç¢¼
              required: [token, newPassword]
      responses:
        '200':
          description: å¯†ç¢¼é‡è¨­æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '400':
          description: ä»¤ç‰Œç„¡æ•ˆæˆ–å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/PasswordResetResponse'
                  - $ref: '#/components/schemas/PasswordWeakError'
        '422':
          description: åƒæ•¸é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ErrorResponse'
                  - $ref: '#/components/schemas/PasswordWeakError'

  /auth/change-password:
    post:
      tags: [auth]
      summary: æ›´æ–°å¯†ç¢¼
      description: å·²ç™»å…¥ç”¨æˆ¶æ›´æ–°å¯†ç¢¼
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                currentPassword:
                  type: string
                  description: ç•¶å‰å¯†ç¢¼
                newPassword:
                  type: string
                  minLength: 8
                  description: æ–°å¯†ç¢¼
              required: [currentPassword, newPassword]
      responses:
        '200':
          description: å¯†ç¢¼æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordChangeResponse'
        '400':
          description: å¯†ç¢¼é©—è­‰å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetResponse'
        '422':
          description: æ–°å¯†ç¢¼ä¸ç¬¦åˆè¦æ±‚
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordWeakError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/password-expiry-status:
    get:
      tags: [auth]
      summary: æª¢æŸ¥å¯†ç¢¼éæœŸç‹€æ…‹
      description: ç²å–ç”¨æˆ¶å¯†ç¢¼éæœŸç‹€æ…‹è³‡è¨Š
      security:
        - bearerAuth: []
      responses:
        '200':
          description: å¯†ç¢¼éæœŸç‹€æ…‹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordExpiryStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/oauth/google/start:
    get:
      tags: [auth]
      summary: Google OAuth ç™»å…¥èµ·å§‹ï¼ˆå°å‘ä¾›æ‡‰å•†æˆæ¬Šé ï¼‰
      parameters:
        - $ref: '#/components/parameters/RedirectUrl'
      responses:
        '302': { description: é‡æ–°å°å‘è‡³ Google æˆæ¬Šé  }

  /auth/oauth/google/callback:
    get:
      tags: [auth]
      summary: Google OAuth å›èª¿ï¼ˆäº¤æ›æˆæ¬Šç¢¼ã€å»ºç«‹æœƒè©±ï¼‰
      responses:
        '302': { description: å»ºç«‹æœƒè©±ä¸¦å°å› redirectUrl æˆ–å°å› /login é¡¯ç¤ºéŒ¯èª¤ }

  /auth/oauth/facebook/start:
    get:
      tags: [auth]
      summary: Facebook OAuth ç™»å…¥èµ·å§‹ï¼ˆå°å‘ä¾›æ‡‰å•†æˆæ¬Šé ï¼‰
      parameters:
        - $ref: '#/components/parameters/RedirectUrl'
      responses:
        '302': { description: é‡æ–°å°å‘è‡³ Facebook æˆæ¬Šé  }

  /auth/oauth/facebook/callback:
    get:
      tags: [auth]
      summary: Facebook OAuth å›èª¿ï¼ˆäº¤æ›æˆæ¬Šç¢¼ã€å»ºç«‹æœƒè©±ï¼‰
      responses:
        '302': { description: å»ºç«‹æœƒè©±ä¸¦å°å› redirectUrl æˆ–å°å› /login é¡¯ç¤ºéŒ¯èª¤ }

  /auth/logout:
    post:
      tags: [auth]
      summary: ç™»å‡º
      responses:
        '204':
          description: å·²ç™»å‡º

  /auth/session:
    get:
      tags: [auth]
      summary: æŸ¥è©¢ç›®å‰ Session/Token æœ‰æ•ˆæ€§
      responses:
        '200':
          description: Session æœ‰æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  loggedIn:
                    type: boolean
                    example: true
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                        format: email
                      name:
                        type: string
        '401':
          description: æœªç™»å…¥æˆ–Sessionç„¡æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "æœªç™»å…¥"
                  loggedIn:
                    type: boolean
                    example: false

  /users/profile:
    get:
      tags: [users]
      summary: å–å¾—ä½¿ç”¨è€…å€‹äººè³‡æ–™ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      security:
        - bearerAuth: []
        - cookieAuth: []
      responses:
        '200': { description: ç”¨æˆ¶è³‡æ–™ }
        '401': { $ref: '#/components/responses/Unauthorized' }
    put:
      tags: [users]
      summary: æ›´æ–°ä½¿ç”¨è€…å€‹äººè³‡æ–™ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      security:
        - bearerAuth: []
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                phone:
                  type: string
                avatar:
                  type: string
      responses:
        '200': { description: æ›´æ–°æˆåŠŸ }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /predictions:
    get:
      tags: [predictions]
      summary: å–å¾—é æ¸¬åˆ—è¡¨ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
        - in: query
          name: sport
          schema:
            type: string
            enum: [BASKETBALL, FOOTBALL, BASEBALL, TENNIS, SOCCER]
      responses:
        '200': { description: é æ¸¬åˆ—è¡¨ }
    post:
      tags: [predictions]
      summary: å»ºç«‹é æ¸¬ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      security:
        - bearerAuth: []
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, sport, predictionType, odds, price]
              properties:
                title: { type: string }
                description: { type: string }
                sport: { type: string, enum: [BASKETBALL, FOOTBALL, BASEBALL, TENNIS, SOCCER] }
                predictionType: { type: string, enum: [WIN_LOSE, HANDICAP, OVER_UNDER, CORRECT_SCORE] }
                odds: { type: number }
                price: { type: number }
                matchInfo: { type: object }
      responses:
        '201': { description: é æ¸¬å‰µå»ºæˆåŠŸ }
        '401': { description: æœªæˆæ¬Š }

  /predictions/{id}:
    get:
      tags: [predictions]
      summary: å–å¾—ç‰¹å®šé æ¸¬è©³æƒ…ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200': { description: é æ¸¬è©³æƒ… }
        '404': { description: é æ¸¬ä¸å­˜åœ¨ }
  /me/avatar:
    post:
      tags: [me]
      summary: ä¸Šå‚³ä¸¦è¨­å®šæˆ‘çš„å¤§é ­è²¼ï¼ˆæœ¬æ©Ÿå„²å­˜ï¼Œå›ºå®šæª”å {userId}.webpï¼‰
      security:
        - bearerAuth: []
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: ä¸Šå‚³æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  url:
                    type: string
                    example: "/uploads/avatars/2-1761064089932.jpg"
                  updatedAt:
                    type: string
                    format: date-time
        '401': { $ref: '#/components/responses/Unauthorized' }
        '413':
          description: æª”æ¡ˆéå¤§
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '415':
          description: æª”æ¡ˆæ ¼å¼ä¸æ”¯æ´
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: ä¸Šå‚³å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /me/name:
    patch:
      tags: [me]
      summary: æ›´æ–°æˆ‘çš„ç”¨æˆ¶åç¨±
      description: |
        æ›´æ–°ç•¶å‰ç”¨æˆ¶çš„é¡¯ç¤ºåç¨±
        - é•·åº¦ï¼š2-10 å­—å…ƒ
        - å…§å®¹ï¼šåƒ…å…è¨±ä¸­æ–‡å’Œè‹±æ–‡å­—æ¯
        - é »ç‡ï¼šç„¡é™åˆ¶
      security:
        - bearerAuth: []
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 2
                  maxLength: 10
                  description: ç”¨æˆ¶åç¨±ï¼ˆ2-10å­—å…ƒï¼Œåƒ…ä¸­è‹±æ–‡ï¼‰
                  example: "æ–°åç¨±"
              required: [name]
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  name:
                    type: string
                    example: "æ–°åç¨±"
                  updatedAt:
                    type: string
                    format: date-time
                    example: "2025-10-21T16:30:00.000Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          description: åç¨±æ ¼å¼ä¸æ­£ç¢º
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NameValidationError'
        '500':
          description: ä¼ºæœå™¨éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /members/{id}/profile:
    get:
      tags: [members]
      summary: æœƒå“¡åŸºæœ¬è³‡æ–™
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '200':
          description: æœƒå“¡åŸºæœ¬è³‡æ–™åŠç­‰ç´šè³‡è¨Š
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  profile:
                    $ref: '#/components/schemas/MemberProfile'
                  relationships:
                    type: object
                    properties:
                      isSelf:
                        type: boolean
                        description: æ˜¯å¦ç‚ºæœ¬äºº
                      isFollowing:
                        type: boolean
                        description: æ˜¯å¦å·²è¿½è¹¤
                      isMutual:
                        type: boolean
                        description: æ˜¯å¦äº’ç›¸é—œæ³¨

  /members/{id}/relationships:
    get:
      tags: [members]
      summary: æœƒå“¡èˆ‡ç›®å‰ä½¿ç”¨è€…çš„é—œä¿‚
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '200':
          description: é—œä¿‚è³‡è¨Š
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSelf:
                    type: boolean
                  isFollowing:
                    type: boolean
                  isMutual:
                    type: boolean

  /members/{id}/follow:
    post:
      tags: [members]
      summary: è¿½è¹¤æœƒå“¡
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '204': { description: æˆåŠŸ }
        '401': { $ref: '#/components/responses/Unauthorized' }
    delete:
      tags: [members]
      summary: å–æ¶ˆè¿½è¹¤æœƒå“¡
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '204': { description: æˆåŠŸ }
        '401': { $ref: '#/components/responses/Unauthorized' }

  /members/{id}/stats:
    get:
      tags: [members]
      summary: æœƒå“¡çµ±è¨ˆè³‡è¨Š
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '200':
          description: Stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberStats'

  /members/{id}/honors:
    get:
      tags: [members]
      summary: æœƒå“¡æ¦®è­½åˆ—è¡¨
      parameters:
        - $ref: '#/components/parameters/MemberId'
      responses:
        '200':
          description: honors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MemberHonor'

  /members/{id}/predictions:
    get:
      tags: [members]
      summary: æœƒå“¡é æ¸¬åˆ—è¡¨ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      parameters:
        - $ref: '#/components/parameters/MemberId'
        - $ref: '#/components/parameters/League'
        - $ref: '#/components/parameters/DateRange'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: é æ¸¬æ¸…å–®ï¼ˆåˆ†é ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionsResponse'

  /members/{id}/posts:
    get:
      tags: [posts]
      summary: æœƒå“¡ç™¼æ–‡åˆ—è¡¨ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      parameters:
        - $ref: '#/components/parameters/MemberId'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: ç™¼æ–‡æ¸…å–®ï¼ˆåˆ†é ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostsResponse'

  /filters/leagues:
    get:
      tags: [filters]
      summary: è¯ç›Ÿå­—å…¸ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      responses:
        '200':
          description: leagues
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/League'

  /filters/dates:
    get:
      tags: [filters]
      summary: æ—¥æœŸå­—å…¸ï¼ˆè¿‘ N å¤©ï¼‰ï¼ˆæœªå®Œæˆ/æš«ä¸æä¾›ï¼‰
      description: æœªå®Œæˆ/æš«ä¸æä¾›
      parameters:
        - in: query
          name: range
          schema:
            type: integer
            minimum: 1
            maximum: 31
          description: å›å‚³æœ€è¿‘ N å¤©ï¼ˆå«ä»Šå¤©ï¼‰
      responses:
        '200':
          description: dates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DateFilterItem'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: sgame_session

  parameters:
    MemberId:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: æœƒå“¡ ID æˆ–ä»£è™Ÿ
    League:
      in: query
      name: league
      schema:
        type: string
        description: è¯ç›Ÿä»£ç¢¼ï¼ˆä¾‹å¦‚ MLB/NPB/CPBLï¼‰
    DateRange:
      in: query
      name: dateRange
      schema:
        type: string
        enum: [today, week, month]
      description: é è¨­ç”¨ today/week/monthï¼›è‹¥æ¡ç”¨ç²¾ç¢ºæ—¥æœŸï¼Œæ”¹èµ° /filters/dates èˆ‡é¡å¤– date=YYYY-MM-DD åƒæ•¸
    Page:
      in: query
      name: page
      schema:
        type: integer
        minimum: 1
        default: 1
    Size:
      in: query
      name: size
      schema:
        type: integer
        minimum: 1
        maximum: 50
        default: 20
    OAuthProvider:
      in: path
      name: provider
      required: true
      schema:
        type: string
        enum: [google, facebook, line]
      description: ç¬¬ä¸‰æ–¹ç™»å…¥ä¾›æ‡‰å•†
    RedirectUrl:
      in: query
      name: redirectUrl
      required: false
      schema:
        type: string
      description: ç™»å…¥å®Œæˆå¾Œå°å›çš„ç›¸å°è·¯å¾‘ï¼Œå¾Œç«¯éœ€åšç™½åå–®æª¢æŸ¥

  responses:
    Unauthorized:
      description: æœªæˆæ¬Š
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    OAuthError:
      description: ç¬¬ä¸‰æ–¹ç™»å…¥éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/OAuthError'

  schemas:
    ErrorResponse:
      type: object
      properties:
        code:
          type: string
        message:
          type: string

    OAuthError:
      type: object
      properties:
        code:
          type: string
          enum: [OAUTH_PROVIDER_DENIED, OAUTH_INVALID_STATE, OAUTH_EXCHANGE_FAILED, OAUTH_REDIRECT_INVALID]
        message:
          type: string
        reload:
          type: boolean

    PageMeta:
      type: object
      properties:
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer

    League:
      type: object
      properties:
        id:
          type: integer
        code:
          type: string
          example: MLB
        name:
          type: string

    DateFilterItem:
      type: object
      properties:
        key:
          type: string
          example: '2025-09-16'
        label:
          type: string
          example: '09/16(äºŒ)'

    MemberProfile:
      type: object
      properties:
        id:
          type: integer
          description: ç”¨æˆ¶ID
        email:
          type: string
          format: email
          description: ç”¨æˆ¶éƒµç®±
        name:
          type: string
          description: ç”¨æˆ¶åç¨±
        avatarUrl:
          type: string
          nullable: true
          description: é ­åƒURL
        emailVerified:
          type: boolean
          description: éƒµç®±æ˜¯å¦å·²é©—è­‰
        createdAt:
          type: string
          format: date-time
          description: è¨»å†Šæ™‚é–“
        updatedAt:
          type: string
          format: date-time
          description: æœ€å¾Œæ›´æ–°æ™‚é–“
        level:
          type: string
          description: ç­‰ç´šä»£ç¢¼
        score:
          type: integer
          description: ç”¨æˆ¶åˆ†æ•¸ï¼Œç”¨æ–¼ç­‰ç´šè¨ˆç®—
        bio:
          type: string
          description: å€‹äººç°¡ä»‹
        joinedAt:
          type: string
          format: date-time
          description: åŠ å…¥æ™‚é–“
        followersCount:
          type: integer
          description: è¿½è¹¤è€…æ•¸é‡
        followingCount:
          type: integer
          description: è¿½è¹¤ä¸­æ•¸é‡
        levelInfo:
          type: object
          properties:
            code:
              type: string
            name:
              type: string
            nameEn:
              type: string
            color:
              type: string
            icon:
              type: string
            minScore:
              type: number
            maxScore:
              type: number
            description:
              type: string
            benefits:
              type: array
              items:
                type: string
        levelProgress:
          type: object
          properties:
            percentage:
              type: number
            currentScore:
              type: number
            levelMinScore:
              type: number
            levelMaxScore:
              type: number
            pointsToNext:
              type: number
        nextLevel:
          type: object
          properties:
            code:
              type: string
            name:
              type: string
            nameEn:
              type: string
            color:
              type: string
            icon:
              type: string
            minScore:
              type: number
            maxScore:
              type: number
            description:
              type: string
            benefits:
              type: array
              items:
                type: string

    MemberStats:
      type: object
      properties:
        totalPredictions:
          type: integer
        winRate:
          type: number
          format: float
        winStreak:
          type: integer
        ranking:
          type: integer

    MemberHonor:
      type: object
      properties:
        id:
          type: integer
        icon:
          type: string
        title:
          type: string
        description:
          type: string
        date:
          type: string
          format: date

    MemberPost:
      type: object
      properties:
        id:
          type: integer
        board:
          type: string
        title:
          type: string
        url:
          type: string
        createdAt:
          type: string
          format: date-time
        replies:
          type: integer
        views:
          type: integer
        push:
          type: integer

    PredictionItem:
      type: object
      properties:
        id:
          type: integer
        league:
          type: string
          example: MLB
        gameDateTime:
          type: string
          format: date-time
        homeTeam:
          type: string
        awayTeam:
          type: string
        market:
          type: string
          example: è®“åˆ†
        selection:
          type: string
          example: ä¸» -1.5
        isMainPick:
          type: boolean
        result:
          type: string
          enum: [win, lose, pending]
        score:
          type: object
          properties:
            home:
              type: integer
            away:
              type: integer

    PredictionsResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PredictionItem'
        pageMeta:
          $ref: '#/components/schemas/PageMeta'

    PostsResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/MemberPost'
        pageMeta:
          $ref: '#/components/schemas/PageMeta'

    VerificationResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        message:
          type: string
          description: å›æ‡‰è¨Šæ¯
        expiresIn:
          type: integer
          description: é©—è­‰ç¢¼éæœŸæ™‚é–“ï¼ˆç§’ï¼‰
          example: 300

    VerificationStatusResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        isVerified:
          type: boolean
          description: éƒµç®±æ˜¯å¦å·²é©—è­‰
        email:
          type: string
          format: email
          description: ç”¨æˆ¶éƒµç®±åœ°å€

    EmailVerificationError:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
          default: false
        message:
          type: string
          description: éŒ¯èª¤è¨Šæ¯
        code:
          type: string
          enum: 
            - VERIFICATION_CODE_EXPIRED
            - VERIFICATION_CODE_INVALID
            - EMAIL_ALREADY_VERIFIED
            - RATE_LIMIT_EXCEEDED
            - VERIFICATION_SEND_FAILED
          description: éŒ¯èª¤ä»£ç¢¼

    PasswordWeakError:
      type: object
      properties:
        code:
          type: string
          enum: [PASSWORD_WEAK]
          description: å¯†ç¢¼å¼·åº¦éŒ¯èª¤ä»£ç¢¼
        message:
          type: string
          description: äººé¡å¯è®€çš„éŒ¯èª¤è¨Šæ¯
          example: "å¯†ç¢¼éœ€ç‚º 8â€“12 ç¢¼ï¼Œå«å¤§å°å¯«ã€æ•¸å­—èˆ‡ç‰¹æ®Šç¬¦è™Ÿï¼Œä¸å¯å«ç©ºç™½ï¼Œä¸”ä¸å¯èˆ‡ Email ç›¸é—œ"
        details:
          type: object
          description: æ©Ÿå™¨å¯è®€çš„é©—è­‰è©³æƒ…
          properties:
            length:
              type: boolean
              description: é•·åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ (8-12)
            hasUpper:
              type: boolean
              description: æ˜¯å¦åŒ…å«å¤§å¯«å­—æ¯
            hasLower:
              type: boolean
              description: æ˜¯å¦åŒ…å«å°å¯«å­—æ¯
            hasNumber:
              type: boolean
              description: æ˜¯å¦åŒ…å«æ•¸å­—
            hasSpecial:
              type: boolean
              description: æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—å…ƒ
            noWhitespace:
              type: boolean
              description: æ˜¯å¦ä¸åŒ…å«ç©ºç™½å­—å…ƒ
            notEmailLike:
              type: boolean
              description: æ˜¯å¦èˆ‡ Email ç„¡é—œ
        errors:
          type: array
          description: å…·é«”éŒ¯èª¤è¨Šæ¯åˆ—è¡¨
          items:
            type: string
          example: ["å¯†ç¢¼é•·åº¦å¿…é ˆç‚º 8-12 å­—å…ƒ", "å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹å¤§å¯«å­—æ¯"]

    TooManyAttemptsError:
      type: object
      properties:
        code:
          type: string
          enum: [TOO_MANY_ATTEMPTS]
          description: è«‹æ±‚éæ–¼é »ç¹éŒ¯èª¤ä»£ç¢¼
        message:
          type: string
          description: éŒ¯èª¤è¨Šæ¯
          example: "è¨»å†Šå˜—è©¦éæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œå†è©¦"

    NameValidationError:
      type: object
      properties:
        success:
          type: boolean
          default: false
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        code:
          type: string
          enum: [NAME_INVALID]
          description: åç¨±é©—è­‰éŒ¯èª¤ä»£ç¢¼
        message:
          type: string
          description: äººé¡å¯è®€çš„éŒ¯èª¤è¨Šæ¯
          example: "åç¨±æ ¼å¼ä¸æ­£ç¢º"
        details:
          type: object
          description: æ©Ÿå™¨å¯è®€çš„é©—è­‰è©³æƒ…
          properties:
            length:
              type: boolean
              description: é•·åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚ (2-10)
            onlyChineseEnglish:
              type: boolean
              description: æ˜¯å¦åƒ…åŒ…å«ä¸­è‹±æ–‡
        errors:
          type: array
          description: å…·é«”éŒ¯èª¤è¨Šæ¯åˆ—è¡¨
          items:
            type: string
          example: ["åç¨±é•·åº¦è‡³å°‘éœ€è¦ 2 å€‹å­—å…ƒ", "åç¨±åƒ…å…è¨±ä¸­æ–‡å’Œè‹±æ–‡å­—æ¯"]

    LoginResponse:
      type: object
      properties:
        redirectUrl:
          type: string
          description: ç™»å…¥å¾Œå°å›è·¯å¾‘ï¼Œè‹¥ç¼ºçœå‰‡ç”±å‰ç«¯æ±ºå®šï¼ˆå¦‚é¦–é ï¼‰
        message:
          type: string
          description: ç™»å…¥è¨Šæ¯
          example: "ç™»å…¥æˆåŠŸ"
        token:
          type: string
          description: JWT Bearer Tokenï¼Œç”¨æ–¼å¾ŒçºŒ API èªè­‰
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        passwordExpiry:
          $ref: '#/components/schemas/PasswordExpiryInfo'

    PasswordExpiryInfo:
      type: object
      properties:
        isExpired:
          type: boolean
          description: å¯†ç¢¼æ˜¯å¦å·²éæœŸ
        isWarning:
          type: boolean
          description: æ˜¯å¦åœ¨è­¦å‘ŠæœŸå…§ï¼ˆ7å¤©å…§éæœŸï¼‰
        daysUntilExpiry:
          type: integer
          description: è·é›¢éæœŸå¤©æ•¸
        message:
          type: string
          description: äººé¡å¯è®€çš„ç‹€æ…‹è¨Šæ¯
          example: "æ‚¨çš„å¯†ç¢¼ç‹€æ…‹æ­£å¸¸ï¼Œè·é›¢éæœŸé‚„æœ‰ 180 å¤©ã€‚"

    PasswordResetResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        message:
          type: string
          description: å›æ‡‰è¨Šæ¯
          example: "å¯†ç¢¼é‡è¨­éƒµä»¶å·²ç™¼é€è‡³æ‚¨çš„éƒµç®±ï¼Œè«‹åœ¨ 24 å°æ™‚å…§å®Œæˆé‡è¨­"

    TokenVerificationResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        valid:
          type: boolean
          description: ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
        email:
          type: string
          format: email
          description: ç”¨æˆ¶éƒµç®±åœ°å€ï¼ˆåƒ…åœ¨ä»¤ç‰Œæœ‰æ•ˆæ™‚æä¾›ï¼‰
        message:
          type: string
          description: å›æ‡‰è¨Šæ¯

    PasswordChangeResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        message:
          type: string
          description: å›æ‡‰è¨Šæ¯
          example: "å¯†ç¢¼æ›´æ–°æˆåŠŸ"
        passwordExpiry:
          $ref: '#/components/schemas/PasswordExpiryInfo'

    PasswordExpiryStatusResponse:
      type: object
      properties:
        success:
          type: boolean
          description: æ“ä½œæ˜¯å¦æˆåŠŸ
        isExpired:
          type: boolean
          description: å¯†ç¢¼æ˜¯å¦å·²éæœŸ
        isWarning:
          type: boolean
          description: æ˜¯å¦åœ¨è­¦å‘ŠæœŸå…§
        daysUntilExpiry:
          type: integer
          description: è·é›¢éæœŸå¤©æ•¸
        daysSinceChange:
          type: integer
          description: å¯†ç¢¼è®Šæ›´å¾Œç¶“éå¤©æ•¸
        lastChanged:
          type: string
          format: date-time
          description: å¯†ç¢¼æœ€å¾Œè®Šæ›´æ™‚é–“
        message:
          type: string
          description: äººé¡å¯è®€çš„ç‹€æ…‹è¨Šæ¯

security:
  - bearerAuth: []
  - cookieAuth: []


