## å¾Œç«¯ API æ¸¬è©¦æ¸…å–®ï¼ˆå‹¾é¸ç”¨ï¼‰

åŸºåº• URLï¼ˆæ­£å¼ï¼‰ï¼š`https://api.sportspro.tw/api`

### æ ¸å¿ƒ/å¥åº·æª¢æŸ¥
- [V] `GET /health`ï¼ˆé /api å‰ç¶´ï¼‰

### èªè­‰ï¼ˆauthï¼‰

#### åŸºæœ¬èªè­‰
- [V] `POST /auth/login` â€” ç™»å…¥ï¼ˆSet-Cookie: sgame_sessionï¼‰ï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /auth/session` â€” æŸ¥è©¢ç›®å‰ç™»å…¥ç‹€æ…‹ï¼ˆloggedInã€userId ç­‰ï¼‰ï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/logout` â€” ç™»å‡ºï¼ˆæ¸…é™¤ Cookieï¼Œ204ï¼‰ï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/register` â€” è¨»å†Šï¼ˆemail/password/nameï¼›201ï¼Œæ”¯æ´éƒµç®±é©—è­‰ï¼‰ï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰

#### éƒµç®±é©—è­‰
- [V] `POST /auth/send-verification` â€” ç™¼é€éƒµç®±é©—è­‰ç¢¼ï¼ˆéœ€ç™»å…¥ï¼Œ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/verify-email` â€” é©—è­‰éƒµç®±é©—è­‰ç¢¼ï¼ˆéœ€ç™»å…¥ï¼Œ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /auth/verification-status` â€” æª¢æŸ¥éƒµç®±é©—è­‰ç‹€æ…‹ï¼ˆéœ€ç™»å…¥ï¼Œ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰

**æ³¨æ„**: `/auth/resend-verification` ç«¯é»å·²ç§»é™¤ï¼Œè«‹ä½¿ç”¨ `/auth/send-verification` é€²è¡Œåˆæ¬¡ç™¼é€å’Œé‡æ–°ç™¼é€ï¼Œæœå‹™æœƒè‡ªå‹•è™•ç†å†·å»æ™‚é–“ï¼ˆ60ç§’ï¼‰

#### å¯†ç¢¼é‡è¨­
- [V] `POST /auth/forgot-password` â€” å¿˜è¨˜å¯†ç¢¼ - ç™¼é€é‡è¨­éƒµä»¶ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/verify-reset-token` â€” é©—è­‰å¯†ç¢¼é‡è¨­ä»¤ç‰Œï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/reset-password` â€” é‡è¨­å¯†ç¢¼ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /auth/change-password` â€” æ›´æ–°å¯†ç¢¼ï¼ˆéœ€ç™»å…¥ï¼‰ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /auth/password-expiry-status` â€” æª¢æŸ¥å¯†ç¢¼éæœŸç‹€æ…‹ï¼ˆéœ€ç™»å…¥ï¼‰ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰

#### ç¬¬ä¸‰æ–¹ç™»å…¥ï¼ˆOAuthï¼‰
- [â¸ï¸] `GET /auth/oauth/google/start?redirectUrl=...` â€” Google OAuth ç™»å…¥èµ·å§‹ï¼ˆå¾Œç«¯å·²å¯¦ä½œï¼Œéœ€å…¬ç¶²ç’°å¢ƒæ¸¬è©¦ï¼‰
- [â¸ï¸] `GET /auth/oauth/google/callback` â€” Google OAuth å›èª¿ï¼ˆSet-Cookie + 302ï¼‰ï¼ˆå¾Œç«¯å·²å¯¦ä½œï¼Œéœ€å…¬ç¶²ç’°å¢ƒæ¸¬è©¦ï¼‰
- **Google OAuth é™åˆ¶**ï¼šä¸æ”¯æ´ç§æœ‰ IP (10.x.x.x) ä½œç‚º callback URL
- **éƒ¨ç½²èªªæ˜**ï¼šç”Ÿç”¢ç’°å¢ƒåªéœ€æ›´æ–° `GOOGLE_CALLBACK_URL` ç’°å¢ƒè®Šæ•¸å³å¯ä½¿ç”¨ï¼ˆè©³è¦‹ `/apiæ–‡æª”/Google-OAuth-é…ç½®èªªæ˜.md`ï¼‰
- [ ] `GET /auth/oauth/facebook/start?redirectUrl=...` â€” Facebook OAuth ç™»å…¥èµ·å§‹ï¼ˆæœªå¯¦ä½œï¼‰
- [ ] `GET /auth/oauth/facebook/callback` â€” Facebook OAuth å›èª¿ï¼ˆæœªå¯¦ä½œï¼‰
- [ ] `GET /auth/oauth/line/start?redirectUrl=...` â€” LINE OAuth ç™»å…¥èµ·å§‹ï¼ˆæœªå¯¦ä½œï¼‰
- [ ] `GET /auth/oauth/line/callback` â€” LINE OAuth å›èª¿ï¼ˆæœªå¯¦ä½œï¼‰

### æœƒå“¡ï¼ˆmembersï¼‰
- [V] `GET /members/{id}/profile` â€” æœƒå“¡åŸºæœ¬è³‡æ–™ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /members/{id}/relationships` â€” èˆ‡ç›®å‰ä½¿ç”¨è€…é—œä¿‚ï¼ˆisSelf/isFollowing/isMutualï¼‰ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `POST /members/{id}/follow` â€” è¿½è¹¤ï¼ˆ204ï¼‰ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `DELETE /members/{id}/follow` â€” å–æ¶ˆè¿½è¹¤ï¼ˆ204ï¼‰ï¼ˆ2025-10-21ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /members/search` â€” ä»¥æš±ç¨±æœå°‹ç©å®¶ï¼ˆ2025-11-04ï¼Œmembers.int.test.ts é€šéï¼‰
- [V] `GET /members/recommendations` â€” æ¨è–¦æ­£ç¢ºç‡/ç­‰ç´šå‰äº”åï¼ˆ2025-11-04ï¼Œmembers.int.test.ts é€šéï¼‰
- [ ] `GET /members/{id}/stats` â€” æœƒå“¡çµ±è¨ˆï¼ˆç¸½é æ¸¬ã€å‹ç‡ã€é€£å‹ã€æ’åï¼‰
- [ ] `GET /members/{id}/honors` â€” æœƒå“¡æ¦®è­½åˆ—è¡¨
- [ ] `GET /members/{id}/posts` â€” æœƒå“¡ç™¼æ–‡æ¸…å–®ï¼ˆpageã€sizeï¼‰

### æœƒå“¡ç­‰ç´šï¼ˆlevelsï¼‰
- [V] `GET /levels` â€” ç²å–æ‰€æœ‰ç­‰ç´šè³‡è¨Šï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰
- [V] `GET /levels/stats` â€” ç²å–ç­‰ç´šçµ±è¨ˆè³‡è¨Šï¼ˆ2025-10-20ï¼Œå·²æ¸¬è©¦é€šéï¼‰

### å€‹äººè¨­å®šï¼ˆmeï¼‰
- [V] `POST /me/avatar` â€” ä¸Šå‚³å¤§é ­è²¼ï¼ˆ<5MBã€jpeg/png/webpï¼›200 å› `{ url, updatedAt }`ï¼›401/413/415/500ï¼‰ï¼ˆ2025-10-21ï¼Œå·²å¯¦ä½œä¸¦æ¸¬è©¦é€šéï¼‰
  - **å‰ç«¯ä½¿ç”¨**: è¿”å›çš„ `url` ç‚ºç›¸å°è·¯å¾‘ï¼ˆå¦‚ `/uploads/avatars/2-xxx.jpg`ï¼‰ï¼Œå‰ç«¯éœ€çµ„åˆç‚ºå®Œæ•´ URL: `API_BASE + url`
  - **æœƒå“¡è³‡æ–™**: `GET /members/{id}/profile` è¿”å›çš„ `avatarUrl` ä½¿ç”¨ç›¸åŒæ ¼å¼
  - **è©³ç´°èªªæ˜**: åƒè¦‹ `/apiæ–‡æª”/å‰ç«¯æ•´åˆæ–‡æª”/é ­åƒåŠŸèƒ½èªªæ˜.md`
- [V] `PATCH /me/name` â€” æ›´æ–°ç”¨æˆ¶åç¨±ï¼ˆ2-10å­—å…ƒï¼Œåƒ…ä¸­è‹±æ–‡ï¼›200 å› `{ success, name, updatedAt }`ï¼›401/422/500ï¼‰ï¼ˆ2025-10-21ï¼Œå·²å¯¦ä½œä¸¦æ¸¬è©¦é€šéï¼‰
  - **åç¨±è¦å‰‡**: é•·åº¦ 2-10 å­—å…ƒï¼Œåƒ…å…è¨±ä¸­æ–‡å’Œè‹±æ–‡å­—æ¯
  - **ä¿®æ”¹é »ç‡**: ç„¡é™åˆ¶
  - **éŒ¯èª¤éŸ¿æ‡‰**: 422 è¿”å›è©³ç´°çš„é©—è­‰éŒ¯èª¤ï¼ˆ`NAME_INVALID`ï¼‰
  - **è©³ç´°èªªæ˜**: åƒè¦‹ `/apiæ–‡æª”/å‰ç«¯æ•´åˆæ–‡æª”/ç”¨æˆ¶åç¨±åŠŸèƒ½èªªæ˜.md`

### é æ¸¬ï¼ˆpredictionsï¼‰
- [ ] `GET /members/{id}/predictions?league=...&dateRange=today|week|month&page=&size=` â€” é æ¸¬æ¸…å–®

### å­—å…¸/ç¯©é¸ï¼ˆfiltersï¼‰
- [ ] `GET /filters/leagues` â€” è¯ç›Ÿå­—å…¸ï¼ˆid/code/nameï¼‰
- [ ] `GET /filters/dates?range=7` â€” è¿‘ N å¤©æ—¥æœŸéµèˆ‡æ¨™ç±¤

---

## ğŸ“ æ¸¬è©¦èªªæ˜

### Email é©—è­‰æ¸¬è©¦èªªæ˜
- **è¨»å†Šæµç¨‹**ï¼š`POST /auth/register` å›æ‡‰åŒ…å« `needsVerification: true`ï¼Œ**ä¸¦è‡ªå‹•ç™¼é€é©—è­‰éƒµä»¶**ï¼ˆ2025-10-21 å·²å¯¦ä½œï¼‰
- **ç™¼é€é©—è­‰ç¢¼**ï¼š`POST /auth/send-verification` éœ€è¦ç™»å…¥ç‹€æ…‹ï¼ˆç”¨æ–¼é‡æ–°ç™¼é€ï¼‰
- **é©—è­‰ç¢¼æ ¼å¼**ï¼š6 ä½æ•¸æ•¸å­—ï¼ŒéæœŸæ™‚é–“ 5 åˆ†é˜
- **é‡æ–°ç™¼é€**ï¼šä½¿ç”¨ç›¸åŒçš„ `/auth/send-verification` ç«¯é»ï¼Œæœ‰ 60 ç§’å†·å»æ™‚é–“é™åˆ¶
- **éŒ¯èª¤è™•ç†**ï¼šæ”¯æ´å¤šç¨®éŒ¯èª¤ç¢¼ï¼ˆéæœŸã€ç„¡æ•ˆã€å·²é©—è­‰ç­‰ï¼‰

### å¯†ç¢¼é‡è¨­æ¸¬è©¦èªªæ˜
- **å¿˜è¨˜å¯†ç¢¼æµç¨‹**ï¼š`POST /auth/forgot-password` ç™¼é€é‡è¨­éƒµä»¶
- **ä»¤ç‰Œé©—è­‰**ï¼š`POST /auth/verify-reset-token` é©—è­‰é‡è¨­ä»¤ç‰Œ
- **å¯†ç¢¼é‡è¨­**ï¼š`POST /auth/reset-password` ä½¿ç”¨ä»¤ç‰Œé‡è¨­å¯†ç¢¼
- **å¯†ç¢¼æ›´æ–°**ï¼š`POST /auth/change-password` å·²ç™»å…¥ç”¨æˆ¶æ›´æ–°å¯†ç¢¼
- **éæœŸæª¢æŸ¥**ï¼š`GET /auth/password-expiry-status` æŸ¥è©¢å¯†ç¢¼éæœŸç‹€æ…‹
- **å®‰å…¨æ©Ÿåˆ¶**ï¼š24 å°æ™‚ä»¤ç‰ŒéæœŸã€5 åˆ†é˜é‡ç™¼å†·å»ã€OAuth ç”¨æˆ¶æ’é™¤
- **å¯†ç¢¼éæœŸ**ï¼š180 å¤©éæœŸã€7 å¤©è­¦å‘ŠæœŸã€ç™»å…¥æ™‚è‡ªå‹•æª¢æŸ¥

### Google OAuth æ¸¬è©¦èªªæ˜
- **é…ç½®è¦æ±‚**ï¼šéœ€è¦åœ¨ `docker-compose.yml` æˆ–éƒ¨ç½²ç’°å¢ƒä¸­è¨­å®š `GOOGLE_CLIENT_ID`ã€`GOOGLE_CLIENT_SECRET`
- **å›èª¿ URL**ï¼š`https://api.sportspro.tw/api/auth/oauth/google/callback`
- **ç™»å…¥æµç¨‹**ï¼š
  1. å‰ç«¯å°å‘ `/auth/oauth/google/start?redirectUrl=/dashboard`
  2. ç”¨æˆ¶åœ¨ Google æˆæ¬Šé é¢ç™»å…¥
  3. Google å›èª¿è‡³ `/auth/oauth/google/callback`
  4. å¾Œç«¯è¨­å®š session cookie ä¸¦å°å›å‰ç«¯æŒ‡å®šçš„ `redirectUrl`
- **å¸³è™Ÿé€£çµ**ï¼šå¦‚æœ email å·²å­˜åœ¨ï¼Œæœƒè‡ªå‹•é€£çµ Google å¸³è™Ÿ
- **æ–°ç”¨æˆ¶**ï¼šè‡ªå‹•å»ºç«‹å¸³è™Ÿä¸¦è¨­å®šåˆå§‹ç­‰ç´šï¼ˆé’éŠ…ï¼‰

### Email é…ç½®èªªæ˜ï¼ˆGmail æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ï¼‰
- **SMTP è¨­å®š**ï¼š
  - `SMTP_HOST=smtp.gmail.com`
  - `SMTP_PORT=587`
  - `SMTP_USER=your-email@gmail.com`
  - `SMTP_PASS=your-16-char-app-password`ï¼ˆGoogle æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ï¼‰
- **å–å¾—æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼**ï¼š
  1. ç™»å…¥ Google å¸³è™Ÿ
  2. å‰å¾€ã€Œå®‰å…¨æ€§ã€â†’ã€Œå…©æ­¥é©Ÿé©—è­‰ã€
  3. åœ¨ã€Œæ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ã€ä¸­ç”Ÿæˆæ–°å¯†ç¢¼
  4. å°‡ 16 ä½å¯†ç¢¼å¡«å…¥ `SMTP_PASS`

### é€Ÿç‡é™åˆ¶é…ç½®
- **é–‹ç™¼ç’°å¢ƒ**ï¼šè¨­å®š `DISABLE_RATE_LIMIT=true` å¯å®Œå…¨åœç”¨é€Ÿç‡é™åˆ¶
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼šè¨­å®š `DISABLE_RATE_LIMIT=false` æˆ–ç§»é™¤è©²ç’°å¢ƒè®Šæ•¸ä»¥å•Ÿç”¨é€Ÿç‡é™åˆ¶
- **é è¨­é™åˆ¶**ï¼š
  - å…¨åŸŸï¼š15 åˆ†é˜å…§ 100 æ¬¡è«‹æ±‚
  - ç™»å…¥ï¼š15 åˆ†é˜å…§ 5 æ¬¡å˜—è©¦
  - è¨»å†Šï¼š1 å°æ™‚å…§ 3 æ¬¡è¨»å†Š
  - é©—è­‰ç¢¼ï¼š1 åˆ†é˜å…§ 1 æ¬¡ç™¼é€
  - å¯†ç¢¼é‡è¨­ï¼š1 å°æ™‚å…§ 3 æ¬¡è«‹æ±‚

---

## ğŸ”§ ç’°å¢ƒè®Šæ•¸é…ç½®

### å¿…è¦é…ç½®ï¼ˆdocker-compose.ymlï¼‰

```yaml
environment:
  # Email é…ç½®ï¼ˆGmail æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼ï¼‰
  - SMTP_HOST=smtp.gmail.com
  - SMTP_PORT=587
  - SMTP_USER=your-email@gmail.com
  - SMTP_PASS=your-16-char-app-password
  - EMAIL_FROM=noreply@sgame.com
  - FRONTEND_URL=https://app.sportspro.tw
  
  # Google OAuth é…ç½®
  - GOOGLE_CLIENT_ID=your-google-client-id
  - GOOGLE_CLIENT_SECRET=your-google-client-secret
  - GOOGLE_CALLBACK_URL=https://api.sportspro.tw/api/auth/oauth/google/callback
  
  # é€Ÿç‡é™åˆ¶é…ç½®
  - DISABLE_RATE_LIMIT=true  # é–‹ç™¼ç’°å¢ƒè¨­ç‚º true
```

---

## å‚™è¨»

### OAuth ç­–ç•¥
- æœ¬ç³»çµ±æ¡ã€Œä¸€å¸³åƒ…èƒ½ç¶å®šä¸€ç¨®ä¾›æ‡‰å•†ã€ç­–ç•¥ï¼š`users.oauthProvider + oauthProviderUserId` å”¯ä¸€
- ç¬¬ä¸€æ¬¡ç¬¬ä¸‰æ–¹ç™»å…¥è‹¥æ‰¾ä¸åˆ°å¸³è™Ÿæœƒè‡ªå‹•å»ºç«‹ï¼ˆç¬¬ä¸‰æ–¹è¨»å†Šï¼‰ï¼Œå…¶å¾Œå³ç‚ºç™»å…¥
- å¦‚æœ email å·²å­˜åœ¨ï¼ˆé€é email/password è¨»å†Šï¼‰ï¼Œæœƒè‡ªå‹•é€£çµ OAuth å¸³è™Ÿ

### å¯†ç¢¼æ”¿ç­–
- **é•·åº¦**ï¼š8-12 å­—å…ƒ
- **è¤‡é›œåº¦**ï¼šå¿…é ˆåŒ…å«å¤§å¯«ã€å°å¯«ã€æ•¸å­—ã€ç‰¹æ®Šç¬¦è™Ÿ
- **é™åˆ¶**ï¼šä¸å¯åŒ…å«ç©ºç™½ã€ä¸å¯èˆ‡ email ç›¸é—œ
- **éæœŸ**ï¼š180 å¤©å¾ŒéæœŸï¼Œ7 å¤©å‰é–‹å§‹è­¦å‘Š
- **OAuth ç”¨æˆ¶**ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹ç™»å…¥çš„ç”¨æˆ¶ç„¡å¯†ç¢¼ï¼Œç„¡æ³•ä½¿ç”¨å¯†ç¢¼é‡è¨­åŠŸèƒ½

### æ¸¬è©¦å»ºè­°
- å‹¾é¸å®Œæˆå¾Œå¯æ–¼æ—åŠ ä¸Šæ¸¬è©¦æ—¥æœŸ/èªªæ˜ï¼Œä¾‹å¦‚ï¼š`[V] GET /auth/sessionï¼ˆ2025-10-21ï¼Œå‰ç«¯åŒæºä»£ç†é€šéï¼‰`
- å»ºè­°å…ˆåœ¨é–‹ç™¼ç’°å¢ƒæ¸¬è©¦æ‰€æœ‰åŠŸèƒ½å¾Œå†éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
- ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å‰è«‹å‹™å¿…æ›´æ›æ‰€æœ‰å¯†é‘°ï¼ˆJWT_SECRETã€SESSION_SECRET ç­‰ï¼‰

---

*æœ€å¾Œæ›´æ–°: 2025-10-21*
*API ç‰ˆæœ¬: v1.0.0*
