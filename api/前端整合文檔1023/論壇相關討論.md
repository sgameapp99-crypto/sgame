# è«–å£‡ç³»çµ±è¨­è¨ˆè¨è«– - å¾Œç«¯å›è¦†

## ğŸ“… è¨è«–æ™‚é–“
**2025å¹´10æœˆ23æ—¥**

---

## ğŸ¯ è¨­è¨ˆæ±ºç­–èˆ‡å»ºè­°

æ ¹æ“šç¾æœ‰ç³»çµ±æ¶æ§‹å’Œæœ€ä½³å¯¦è¸ï¼Œé‡å°å‰ç«¯æå‡ºçš„5å€‹é—œéµè¨­è¨ˆå•é¡Œï¼Œæˆ‘å€‘æä¾›ä»¥ä¸‹å»ºè­°ï¼š

---

### 1ï¸âƒ£ æ–‡ç« å…§å®¹å„²å­˜æ ¼å¼

**å»ºè­°ï¼šc) å¯Œæ–‡æœ¬ JSONï¼ˆå¦‚ Quillã€TipTap æ ¼å¼ï¼‰** âœ…

#### ç†ç”±

| å„ªé» | èªªæ˜ |
|------|------|
| ğŸ¨ **æ ¼å¼è±å¯Œ** | æ”¯æ´ç²—é«”ã€æ–œé«”ã€æ¨™é¡Œã€åˆ—è¡¨ã€åœ–ç‰‡ã€é€£çµç­‰ |
| ğŸ”’ **XSS é˜²è­·** | JSON æ ¼å¼æ›´å®¹æ˜“åšå…§å®¹æ·¨åŒ– |
| ğŸ“± **å¤šç«¯æ”¯æ´** | å‰ç«¯å¯ä»¥è¼•é¬†æ¸²æŸ“åˆ°ä¸åŒå¹³å° |
| ğŸ”„ **å¯æ“´å±•** | æœªä¾†å¯ä»¥åŠ å…¥è‡ªå®šç¾©å€å¡Šï¼ˆå¦‚ç¨‹å¼ç¢¼ã€å¼•ç”¨ç­‰ï¼‰ |
| ğŸ’¾ **PostgreSQL åŸç”Ÿæ”¯æ´** | JSONB æ¬„ä½æ•ˆèƒ½å¥½ï¼Œå¯æŸ¥è©¢ |

#### æ¨è–¦æ–¹æ¡ˆ

**ä½¿ç”¨ TipTapï¼ˆæ¨è–¦ï¼‰æˆ– Quill**

```typescript
// è³‡æ–™åº«å„²å­˜æ ¼å¼
content: {
  type: "doc",
  content: [
    {
      type: "paragraph",
      content: [
        { type: "text", text: "é€™æ˜¯ä¸€æ®µ" },
        { type: "text", marks: [{ type: "bold" }], text: "ç²—é«”" },
        { type: "text", text: "æ–‡å­—" }
      ]
    },
    {
      type: "image",
      attrs: {
        src: "https://example.com/image.jpg",
        alt: "æè¿°"
      }
    }
  ]
}
```

#### Schema è¨­è¨ˆ

```prisma
model Post {
  content       Json         // ä½¿ç”¨ JSONB å„²å­˜å¯Œæ–‡æœ¬
  contentText   String?      // ç´”æ–‡å­—ç‰ˆæœ¬ï¼ˆç”¨æ–¼æœå°‹ï¼‰
  contentHtml   String?      // HTML å¿«å–ï¼ˆé¸å¡«ï¼Œæå‡è®€å–æ•ˆèƒ½ï¼‰
}
```

---

### 2ï¸âƒ£ åœ–ç‰‡/é™„ä»¶è™•ç†

**å»ºè­°ï¼šb) ç¨ç«‹é™„ä»¶è¡¨ï¼Œé—œè¯åˆ°æ–‡ç« ** âœ…

#### ç†ç”±

| å„ªé» | èªªæ˜ |
|------|------|
| ğŸ“Š **æ›´å¥½çš„ç®¡ç†** | å¯ä»¥è¿½è¹¤æ¯å€‹æª”æ¡ˆçš„å¤§å°ã€é¡å‹ã€ä¸Šå‚³æ™‚é–“ |
| ğŸ”„ **å¯é‡è¤‡ä½¿ç”¨** | åŒä¸€å€‹åœ–ç‰‡å¯ä»¥è¢«å¤šç¯‡æ–‡ç« å¼•ç”¨ |
| ğŸ—‘ï¸ **æ¸…ç†æ©Ÿåˆ¶** | å®¹æ˜“æ‰¾å‡ºæœªä½¿ç”¨çš„æª”æ¡ˆä¸¦æ¸…ç† |
| ğŸ“ˆ **çµ±è¨ˆåˆ†æ** | å¯ä»¥çµ±è¨ˆå„²å­˜ç©ºé–“ä½¿ç”¨é‡ |
| ğŸ”’ **æ¬Šé™æ§åˆ¶** | å¯ä»¥å°é™„ä»¶å–®ç¨è¨­å®šå­˜å–æ¬Šé™ |

#### Schema è¨­è¨ˆ

```prisma
model Attachment {
  id            Int      @id @default(autoincrement())
  postId        Int?     // å¯ç‚º nullï¼Œå…è¨±æš«å­˜
  userId        Int      // ä¸Šå‚³è€…
  filename      String   // åŸå§‹æª”å
  mimeType      String   // æª”æ¡ˆé¡å‹
  size          Int      // æª”æ¡ˆå¤§å°ï¼ˆbytesï¼‰
  url           String   // å„²å­˜è·¯å¾‘æˆ– URL
  thumbnailUrl  String?  // ç¸®åœ–ï¼ˆåœ–ç‰‡ç”¨ï¼‰
  width         Int?     // åœ–ç‰‡å¯¬åº¦
  height        Int?     // åœ–ç‰‡é«˜åº¦
  uploadedAt    DateTime @default(now())
  
  post          Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id])
  
  @@index([postId])
  @@index([userId])
  @@map("attachments")
}

model Post {
  // ... å…¶ä»–æ¬„ä½
  attachments   Attachment[]
}
```

#### ä½¿ç”¨æµç¨‹

1. **ä¸Šå‚³æ™‚**ï¼šç”¨æˆ¶ä¸Šå‚³åœ–ç‰‡ â†’ å„²å­˜åˆ° `attachments` è¡¨ â†’ è¿”å› URL
2. **ç·¨è¼¯æ™‚**ï¼šæ–‡ç« å…§å®¹å¼•ç”¨ `attachment.url`
3. **ç™¼å¸ƒæ™‚**ï¼šé—œè¯ `attachments.postId` åˆ°æ–‡ç« 
4. **åˆªé™¤æ™‚**ï¼šCascade åˆªé™¤æœƒè‡ªå‹•æ¸…ç†é™„ä»¶

---

### 3ï¸âƒ£ ç”¨æˆ¶é—œè¯æ–¹å¼

**å»ºè­°ï¼ša) ç›´æ¥é—œè¯ç¾æœ‰ç”¨æˆ¶è¡¨** âœ…

#### ç†ç”±

| å„ªé» | èªªæ˜ |
|------|------|
| ğŸ¯ **çµ±ä¸€ç”¨æˆ¶ç³»çµ±** | é¿å…è³‡æ–™é‡è¤‡å’Œä¸ä¸€è‡´ |
| ğŸ” **å–®ä¸€ç™»å…¥** | ä½¿ç”¨ç¾æœ‰çš„èªè­‰ç³»çµ± |
| ğŸ“Š **å®Œæ•´ç”¨æˆ¶ç•«åƒ** | å¯ä»¥è·¨åŠŸèƒ½åˆ†æç”¨æˆ¶è¡Œç‚º |
| ğŸ’¾ **ç¯€çœå„²å­˜** | ä¸éœ€è¦é‡è¤‡å„²å­˜ç”¨æˆ¶è³‡è¨Š |
| ğŸ”„ **å³æ™‚åŒæ­¥** | ç”¨æˆ¶è³‡æ–™æ›´æ–°ç«‹å³åæ˜ åœ¨è«–å£‡ |

#### Schema è¨­è¨ˆ

```prisma
// ç¾æœ‰çš„ User modelï¼ˆå·²å­˜åœ¨ï¼‰
model User {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  name              String
  role              String   @default("user")
  avatarUrl         String?
  
  // è«–å£‡ç›¸é—œé—œè¯ï¼ˆæ–°å¢ï¼‰
  posts             Post[]
  comments          Comment[]
  postLikes         PostLike[]
  commentLikes      CommentLike[]
  
  @@map("users")
}

model Post {
  authorId      Int
  author        User     @relation(fields: [authorId], references: [id])
  
  @@index([authorId])
}
```

#### é¡å¤–çš„ç”¨æˆ¶è³‡æ–™ï¼ˆé¸å¡«ï¼‰

å¦‚æœéœ€è¦è«–å£‡å°ˆå±¬çš„ç”¨æˆ¶è¨­å®šï¼š

```prisma
model ForumUserProfile {
  userId        Int      @id
  signature     String?  // ç°½åæª”
  title         String?  // é ­éŠœ
  postCount     Int      @default(0)
  reputation    Int      @default(0)
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("forum_user_profiles")
}
```

---

### 4ï¸âƒ£ çœ‹æ¿/åˆ†é¡ç®¡ç†

**å»ºè­°ï¼šb) å‹•æ…‹ç®¡ç†ï¼ˆç®¡ç†å“¡å¯æ–°å¢/ç·¨è¼¯/åˆªé™¤çœ‹æ¿ï¼‰** âœ…

#### ç†ç”±

| å„ªé» | èªªæ˜ |
|------|------|
| ğŸ”„ **éˆæ´»æ€§é«˜** | å¯ä»¥æ ¹æ“šç¤¾ç¾¤ç™¼å±•èª¿æ•´åˆ†é¡ |
| ğŸ“Š **æ˜“æ–¼æ“´å±•** | æ–°å¢ç†±é–€è©±é¡Œçœ‹æ¿ä¸éœ€è¦æ”¹ç¨‹å¼ç¢¼ |
| ğŸ¯ **ç²¾æº–ç®¡ç†** | å¯ä»¥è¨­å®šæ¯å€‹çœ‹æ¿çš„æ¬Šé™å’Œè¦å‰‡ |
| ğŸ“ˆ **æ•¸æ“šé©…å‹•** | æ ¹æ“šä½¿ç”¨æƒ…æ³èª¿æ•´çœ‹æ¿çµæ§‹ |
| ğŸ”’ **æ¬Šé™æ§åˆ¶** | å¯ä»¥è¨­å®šç‰¹å®šçœ‹æ¿çš„å­˜å–é™åˆ¶ |

#### Schema è¨­è¨ˆ

```prisma
model Board {
  id            Int      @id @default(autoincrement())
  name          String   // çœ‹æ¿åç¨±
  slug          String   @unique // URL å‹å–„çš„è­˜åˆ¥ç¢¼
  description   String?  // çœ‹æ¿æè¿°
  icon          String?  // åœ–ç¤º URL
  color         String?  // ä¸»é¡Œè‰²
  order         Int      @default(0) // æ’åº
  isActive      Boolean  @default(true)
  
  // æ¬Šé™è¨­å®š
  isPublic      Boolean  @default(true) // æ˜¯å¦å…¬é–‹
  allowPost     String   @default("all") // èª°å¯ä»¥ç™¼æ–‡ï¼šall, member, admin
  allowComment  String   @default("all") // èª°å¯ä»¥å›è¦†
  
  // çµ±è¨ˆ
  postCount     Int      @default(0)
  
  // é—œè¯
  parentId      Int?     // çˆ¶çœ‹æ¿ï¼ˆæ”¯æ´å­çœ‹æ¿ï¼‰
  parent        Board?   @relation("BoardHierarchy", fields: [parentId], references: [id])
  children      Board[]  @relation("BoardHierarchy")
  posts         Post[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([slug])
  @@index([isActive, order])
  @@map("boards")
}

model Post {
  boardId       Int
  board         Board    @relation(fields: [boardId], references: [id])
  
  @@index([boardId])
}
```

#### ç®¡ç† API

```typescript
// POST /api/admin/boards - å»ºç«‹çœ‹æ¿
// PATCH /api/admin/boards/:id - ç·¨è¼¯çœ‹æ¿
// DELETE /api/admin/boards/:id - åˆªé™¤çœ‹æ¿ï¼ˆè»Ÿåˆªé™¤ï¼‰
// PATCH /api/admin/boards/:id/order - èª¿æ•´é †åº
```

---

### 5ï¸âƒ£ è»Ÿåˆªé™¤ vs ç¡¬åˆªé™¤

**å»ºè­°ï¼ša) è»Ÿåˆªé™¤ï¼ˆä¿ç•™è³‡æ–™ï¼Œæ¨™è¨˜ç‚ºå·²åˆªé™¤ï¼‰** âœ…

#### ç†ç”±

| å„ªé» | èªªæ˜ |
|------|------|
| ğŸ”’ **è³‡æ–™å®‰å…¨** | é˜²æ­¢èª¤åˆªï¼Œå¯ä»¥æ¢å¾© |
| ğŸ“Š **å¯©è¨ˆè¿½è¹¤** | ä¿ç•™å®Œæ•´çš„æ“ä½œè¨˜éŒ„ |
| âš–ï¸ **æ³•è¦éµå¾ª** | ç¬¦åˆè³‡æ–™ä¿ç•™æ”¿ç­– |
| ğŸ” **å…§å®¹å¯©æŸ¥** | å¯ä»¥å¯©æŸ¥é•è¦å…§å®¹ |
| ğŸ“ˆ **æ•¸æ“šåˆ†æ** | ä¿ç•™æ­·å²è³‡æ–™ç”¨æ–¼åˆ†æ |

#### Schema è¨­è¨ˆ

```prisma
model Post {
  id            Int      @id @default(autoincrement())
  title         String
  content       Json
  
  // è»Ÿåˆªé™¤æ¬„ä½
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?     // èª°åˆªé™¤çš„
  deleteReason  String?  // åˆªé™¤åŸå› 
  
  // é—œè¯
  deletedByUser User?    @relation("DeletedPosts", fields: [deletedBy], references: [id])
  
  @@index([isDeleted])
  @@map("posts")
}

model Comment {
  id            Int      @id @default(autoincrement())
  content       String
  
  // è»Ÿåˆªé™¤æ¬„ä½
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  deleteReason  String?
  
  @@index([isDeleted])
  @@map("comments")
}
```

#### æŸ¥è©¢è™•ç†

```typescript
// ä¸€èˆ¬æŸ¥è©¢ï¼ˆä¸é¡¯ç¤ºå·²åˆªé™¤ï¼‰
const posts = await prisma.post.findMany({
  where: { isDeleted: false }
});

// ç®¡ç†å“¡æŸ¥è©¢ï¼ˆåŒ…å«å·²åˆªé™¤ï¼‰
const allPosts = await prisma.post.findMany();

// æ¢å¾©æ–‡ç« 
await prisma.post.update({
  where: { id: postId },
  data: {
    isDeleted: false,
    deletedAt: null,
    deletedBy: null
  }
});
```

---

## ğŸ“‹ å®Œæ•´è³‡æ–™åº« Schema è¨­è¨ˆ

åŸºæ–¼ä»¥ä¸Šæ±ºç­–ï¼Œé€™æ˜¯å®Œæ•´çš„è«–å£‡ç³»çµ±è³‡æ–™åº«è¨­è¨ˆï¼š

```prisma
// ============================================
// è«–å£‡ç³»çµ± Models
// ============================================

// çœ‹æ¿/åˆ†é¡
model Board {
  id            Int      @id @default(autoincrement())
  name          String
  slug          String   @unique
  description   String?
  icon          String?
  color         String?
  order         Int      @default(0)
  isActive      Boolean  @default(true)
  isPublic      Boolean  @default(true)
  allowPost     String   @default("all") // all, member, admin
  allowComment  String   @default("all")
  postCount     Int      @default(0)
  
  parentId      Int?
  parent        Board?   @relation("BoardHierarchy", fields: [parentId], references: [id])
  children      Board[]  @relation("BoardHierarchy")
  posts         Post[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([slug])
  @@index([isActive, order])
  @@map("boards")
}

// æ–‡ç« 
model Post {
  id            Int      @id @default(autoincrement())
  boardId       Int
  authorId      Int
  title         String
  content       Json     // å¯Œæ–‡æœ¬ JSON
  contentText   String?  // ç´”æ–‡å­—ï¼ˆç”¨æ–¼æœå°‹ï¼‰
  contentHtml   String?  // HTML å¿«å–
  
  // ç‹€æ…‹
  status        String   @default("published") // draft, published, locked, hidden
  isSticky      Boolean  @default(false) // ç½®é ‚
  isLocked      Boolean  @default(false) // é–å®šï¼ˆä¸å¯å›è¦†ï¼‰
  
  // çµ±è¨ˆ
  viewCount     Int      @default(0)
  commentCount  Int      @default(0)
  likeCount     Int      @default(0)
  
  // è»Ÿåˆªé™¤
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  deleteReason  String?
  
  // æ™‚é–“æˆ³
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lastCommentAt DateTime @default(now())
  
  // é—œè¯
  board         Board    @relation(fields: [boardId], references: [id])
  author        User     @relation(fields: [authorId], references: [id])
  deletedByUser User?    @relation("DeletedPosts", fields: [deletedBy], references: [id])
  comments      Comment[]
  attachments   Attachment[]
  likes         PostLike[]
  tags          PostTag[]
  
  @@index([boardId, isDeleted, lastCommentAt])
  @@index([authorId])
  @@index([isDeleted, status])
  @@map("posts")
}

// å›è¦†
model Comment {
  id            Int      @id @default(autoincrement())
  postId        Int
  authorId      Int
  content       String   @db.Text
  
  // å›è¦†æ¨“å±¤
  parentId      Int?     // å›è¦†æŸå‰‡ç•™è¨€
  floor         Int      // æ¨“å±¤è™Ÿç¢¼ï¼ˆç¬¬å¹¾æ¨“ï¼‰
  
  // çµ±è¨ˆ
  likeCount     Int      @default(0)
  
  // è»Ÿåˆªé™¤
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  deleteReason  String?
  
  // æ™‚é–“æˆ³
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // é—œè¯
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  author        User     @relation(fields: [authorId], references: [id])
  parent        Comment? @relation("CommentReplies", fields: [parentId], references: [id])
  replies       Comment[] @relation("CommentReplies")
  likes         CommentLike[]
  
  @@index([postId, isDeleted, floor])
  @@index([authorId])
  @@map("comments")
}

// é™„ä»¶
model Attachment {
  id            Int      @id @default(autoincrement())
  postId        Int?
  userId        Int
  filename      String
  mimeType      String
  size          Int
  url           String
  thumbnailUrl  String?
  width         Int?
  height        Int?
  uploadedAt    DateTime @default(now())
  
  post          Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id])
  
  @@index([postId])
  @@index([userId])
  @@map("attachments")
}

// æ–‡ç« æŒ‰è®š
model PostLike {
  id            Int      @id @default(autoincrement())
  postId        Int
  userId        Int
  createdAt     DateTime @default(now())
  
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id])
  
  @@unique([postId, userId])
  @@map("post_likes")
}

// ç•™è¨€æŒ‰è®š
model CommentLike {
  id            Int      @id @default(autoincrement())
  commentId     Int
  userId        Int
  createdAt     DateTime @default(now())
  
  comment       Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id])
  
  @@unique([commentId, userId])
  @@map("comment_likes")
}

// æ¨™ç±¤
model Tag {
  id            Int      @id @default(autoincrement())
  name          String   @unique
  slug          String   @unique
  postCount     Int      @default(0)
  createdAt     DateTime @default(now())
  
  posts         PostTag[]
  
  @@map("tags")
}

// æ–‡ç« æ¨™ç±¤é—œè¯
model PostTag {
  postId        Int
  tagId         Int
  
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag           Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@id([postId, tagId])
  @@map("post_tags")
}

// è«–å£‡ç”¨æˆ¶è³‡æ–™ï¼ˆé¸å¡«ï¼‰
model ForumUserProfile {
  userId        Int      @id
  signature     String?  @db.Text
  title         String?
  postCount     Int      @default(0)
  commentCount  Int      @default(0)
  reputation    Int      @default(0)
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("forum_user_profiles")
}

// æ›´æ–°ç¾æœ‰ User model
model User {
  // ... ç¾æœ‰æ¬„ä½ ...
  
  // è«–å£‡é—œè¯ï¼ˆæ–°å¢ï¼‰
  posts             Post[]
  deletedPosts      Post[]   @relation("DeletedPosts")
  comments          Comment[]
  attachments       Attachment[]
  postLikes         PostLike[]
  commentLikes      CommentLike[]
  forumProfile      ForumUserProfile?
}
```

---

## ğŸš€ API ç«¯é»è¦åŠƒ

### å…¬é–‹ API

```typescript
// çœ‹æ¿
GET    /api/forum/boards              // çœ‹æ¿åˆ—è¡¨
GET    /api/forum/boards/:slug        // çœ‹æ¿è©³æƒ…

// æ–‡ç« 
GET    /api/forum/posts               // æ–‡ç« åˆ—è¡¨ï¼ˆå¯ç¯©é¸çœ‹æ¿ï¼‰
GET    /api/forum/posts/:id           // æ–‡ç« è©³æƒ…
POST   /api/forum/posts               // ç™¼è¡¨æ–‡ç« 
PATCH  /api/forum/posts/:id           // ç·¨è¼¯æ–‡ç« 
DELETE /api/forum/posts/:id           // åˆªé™¤æ–‡ç« 

// å›è¦†
GET    /api/forum/posts/:id/comments  // æ–‡ç« å›è¦†åˆ—è¡¨
POST   /api/forum/posts/:id/comments  // æ–°å¢å›è¦†
PATCH  /api/forum/comments/:id        // ç·¨è¼¯å›è¦†
DELETE /api/forum/comments/:id        // åˆªé™¤å›è¦†

// æŒ‰è®š
POST   /api/forum/posts/:id/like      // æŒ‰è®šæ–‡ç« 
DELETE /api/forum/posts/:id/like      // å–æ¶ˆè®š
POST   /api/forum/comments/:id/like   // æŒ‰è®šå›è¦†
DELETE /api/forum/comments/:id/like   // å–æ¶ˆè®š

// é™„ä»¶
POST   /api/forum/attachments          // ä¸Šå‚³é™„ä»¶
GET    /api/forum/attachments/:id      // å–å¾—é™„ä»¶

// æ¨™ç±¤
GET    /api/forum/tags                 // æ¨™ç±¤åˆ—è¡¨
GET    /api/forum/tags/:slug           // æ¨™ç±¤æ–‡ç« åˆ—è¡¨
```

### ç®¡ç† API

```typescript
// çœ‹æ¿ç®¡ç†
POST   /api/admin/forum/boards         // å»ºç«‹çœ‹æ¿
PATCH  /api/admin/forum/boards/:id     // ç·¨è¼¯çœ‹æ¿
DELETE /api/admin/forum/boards/:id     // åˆªé™¤çœ‹æ¿
PATCH  /api/admin/forum/boards/order   // èª¿æ•´é †åº

// æ–‡ç« ç®¡ç†
GET    /api/admin/forum/posts          // æ‰€æœ‰æ–‡ç« ï¼ˆå«å·²åˆªé™¤ï¼‰
PATCH  /api/admin/forum/posts/:id/lock // é–å®šæ–‡ç« 
PATCH  /api/admin/forum/posts/:id/sticky // ç½®é ‚æ–‡ç« 
POST   /api/admin/forum/posts/:id/restore // æ¢å¾©æ–‡ç« 

// çµ±è¨ˆ
GET    /api/admin/forum/stats          // è«–å£‡çµ±è¨ˆ
```

---

## ğŸ“Š ç´¢å¼•å„ªåŒ–å»ºè­°

```sql
-- æ–‡ç« æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_posts_board_active 
ON posts(board_id, is_deleted, last_comment_at DESC);

-- ç†±é–€æ–‡ç« 
CREATE INDEX idx_posts_popular 
ON posts(is_deleted, view_count DESC, like_count DESC);

-- ç”¨æˆ¶æ–‡ç« 
CREATE INDEX idx_posts_author 
ON posts(author_id, is_deleted, created_at DESC);

-- å…¨æ–‡æœå°‹ï¼ˆPostgreSQLï¼‰
CREATE INDEX idx_posts_fulltext 
ON posts USING gin(to_tsvector('chinese', content_text));
```

---

## ğŸ”’ æ¬Šé™æ§åˆ¶å»ºè­°

```typescript
// æ–‡ç« æ¬Šé™æª¢æŸ¥
function canEditPost(user: User, post: Post): boolean {
  return user.id === post.authorId || user.role === 'admin';
}

function canDeletePost(user: User, post: Post): boolean {
  return user.id === post.authorId || user.role === 'admin';
}

function canPostInBoard(user: User, board: Board): boolean {
  if (board.allowPost === 'all') return true;
  if (board.allowPost === 'member') return user.id !== null;
  if (board.allowPost === 'admin') return user.role === 'admin';
  return false;
}
```

---

## âœ… ç¸½çµ

### è¨­è¨ˆæ±ºç­–

1. âœ… **å¯Œæ–‡æœ¬ JSON** - éˆæ´»ä¸”å®‰å…¨
2. âœ… **ç¨ç«‹é™„ä»¶è¡¨** - æ˜“æ–¼ç®¡ç†å’Œè¿½è¹¤
3. âœ… **é—œè¯ç¾æœ‰ç”¨æˆ¶** - çµ±ä¸€ç”¨æˆ¶ç³»çµ±
4. âœ… **å‹•æ…‹çœ‹æ¿ç®¡ç†** - éˆæ´»å¯æ“´å±•
5. âœ… **è»Ÿåˆªé™¤** - è³‡æ–™å®‰å…¨å¯æ¢å¾©

### é—œéµç‰¹æ€§

- ğŸ“ æ”¯æ´å¯Œæ–‡æœ¬ç·¨è¼¯
- ğŸ“ å®Œæ•´çš„é™„ä»¶ç®¡ç†
- ğŸ’¬ å¤šå±¤å›è¦†æ”¯æ´
- ğŸ‘ æŒ‰è®š/äº’å‹•åŠŸèƒ½
- ğŸ·ï¸ æ¨™ç±¤ç³»çµ±
- ğŸ“Š çµ±è¨ˆè¿½è¹¤
- ğŸ”’ æ¬Šé™æ§åˆ¶
- ğŸ—‘ï¸ è»Ÿåˆªé™¤æ©Ÿåˆ¶

### ä¸‹ä¸€æ­¥

1. ç¢ºèªå‰ç«¯æ˜¯å¦åŒæ„ä»¥ä¸Šè¨­è¨ˆ
2. é–‹å§‹å¯¦ä½œè³‡æ–™åº« Schema
3. å¯¦ä½œæ ¸å¿ƒ APIï¼ˆçœ‹æ¿ã€æ–‡ç« ã€å›è¦†ï¼‰
4. å¯¦ä½œé™„ä»¶ä¸Šå‚³
5. å¯¦ä½œæŒ‰è®šå’Œäº’å‹•åŠŸèƒ½
6. å¯¦ä½œç®¡ç†å¾Œå°

---

**å®Œæˆæ™‚é–“**: 2025å¹´10æœˆ23æ—¥  
**ç‹€æ…‹**: âœ… è¨­è¨ˆå»ºè­°å®Œæˆï¼Œç­‰å¾…å‰ç«¯ç¢ºèª  
**é è¨ˆå·¥ä½œé‡**: 
- Schema å¯¦ä½œ: 2-3 å°æ™‚
- API å¯¦ä½œ: 5-7 å¤©
- æ¸¬è©¦: 2-3 å¤©

---

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–éœ€è¦èª¿æ•´ï¼Œè«‹éš¨æ™‚è¨è«–ï¼

