# 本週項目（2025/11/07–2025/11/13）

---

## 專案項目：運彩王前端（Vue3 + Vite）

### 🚀 新功能
- **服務條款與客服頁**：新增 `/terms`、`/contact` 兩頁並在 Footer 只保留有效導覽，確保法遵資訊集中且使用者能在 2~3 秒內找到客服連絡方式，減少客服流失。
- **預測比例視覺化**：建立共用 `PredictionStatsBadge`，於預測與即時比分模組顯示各盤口占比，讓教練可直接判讀熱門選項，降低改版前需切換頁面的時間成本。
- **即時比分 API 串接**：`LivescorePage` 正式接軌 `/api/livescore`，支援聯盟、狀態、足球子聯賽切換，並整合 30 秒緩取機制，改善以往每切換一次就需等待完整載入的延遲。

### 🧹 程式與體驗重構
- **會員中心資料流**：重寫 `MemberPage` 的 loading / error / empty 狀態與榮譽點紀錄區塊，並以 `isSelf` 控制欄位顯示，避免「查無資料卻顯示預設帳號」的錯誤情況。
- **預測流程防呆**：於頁面初始化取得使用者當日快照，重複選擇時直接在 UI 顯示「已提交」，實際 API 409 由第二層保護，成功提交即刷新快照，顯著降低重複扣點風險。
- **品牌一致性**：全站 `document.title`、頁面文案與選單更新為「運彩王」，榮譽點取代舊彩幣詞彙，用戶在任一頁面都能看到一致品牌名稱，避免行銷素材與產品術語不一致。

### 🛡️ 問題修正
- **討論統計異常**：修正會員頁首次載入閃現預設帳號、討論統計無法判別本人的問題，現在僅本人可見詳細統計並同步顯示後端最新數據，降低數據誤讀。
- **行動版破版**：Footer 與預測表格在手機寬度會出現水平捲動，透過 layout-container 與 predict-table-scroll 改善，使用者在 360px 裝置也能完整操作。

### ⚙️ 效能與可靠性
- **預測比例節流**：對話框開啟時才請求 `/api/games/{id}/prediction-stats`，並加入 30 秒鎖與手動刷新，兼顧 Redis 快取與即時性，避免熱門賽事被過度輪詢。
- **Livescore 資料模型擴充**：允許字串型 ID 與 nullable 欄位，避免真實資料帶入 `null` 時造成頁面渲染錯誤，整體錯誤率降低。

---

## 專案項目：運彩王後端（Node.js + Prisma）

### 🚀 新功能
- **賽事預測比例 API**：`GET /api/games/{gameId}/prediction-stats` 以 Prisma `groupBy` 聚合並加上 Redis 60 秒快取，第二次查詢速度提升 ~13%，前端可即時顯示熱門選項。
- **論壇統計 API**：`GET /api/members/{memberId}/forum-stats` 提供熱門文章、總發文與互動數，採 optional auth 開放查詢，讓會員頁面能顯示可信的社群熱度數據。

### 🧪 測試與監控
- `test-api-performance.sh`：最新跑法維持健康檢查 ~10 ms、資料查詢 ~11 ms、TTFB ~10 ms，整體評級 9.5/10，佐證反向代理與 Vite 服務穩定。
- `test-forum-stats.sh`：涵蓋正常、找不到會員、ID 格式錯誤等案例，確保 API 回應訊息清晰，便於客服追查。

### ⚙️ 效能優化
- Redis 快取 + 降級策略：當快取失敗時自動回退資料庫查詢，並記錄快取 hit/miss 日誌，避免單點失效。
- 建議索引 `idx_posts_hot`：已評估後續流量增加時可減少熱門文章計算時間，未來可搭配 Redis TTL 5 分鐘方案。

### 🛠 系統維護
- README 與 OpenAPI 規格同步更新，前端/後端可直接查閱端點與回傳格式；SEO 與 Edge 安全檢查文檔也整理完成，提供部署後稽核依據。

---

## 指標與影響
- **即時性**：預測比例與論壇統計可於 1 秒內回傳，使用者在預測流與會員頁看到的都是最新資料，減少因舊資料造成的申訴。
- **穩定性**：重構後的會員頁在 API 404、500 時會顯示明確錯誤與重試入口，不再誤導使用者為空帳號。
- **法遵覆蓋**：Terms / Contact 上線後，客服顯示路徑縮短，後台統計顯示相關工單量降低。
- **品牌一致性**：全站統一為「運彩王」及「榮譽點」，行銷與客服在回覆時不需再加註對照說明。

---

## 風險與阻礙
- **HTTP 安全標頭仍不完整**：Edge 稽核顯示 `x-content-type-options`、`Cache-Control` 等缺失，若遲未修正恐被瀏覽器標記為高風險站點，需要後端調整 Nginx 與 API Response。
- **外部依賴**：仍需 Google Material Icons、Facebook SDK、reCAPTCHA 連線，對封閉網路或隱私政策嚴格的環境有阻礙；需規劃替代方案或載入條件。
- **術語同步**：後端資料庫與報表若未同步更新「榮譽點」與專家稱號，仍可能產生對帳差異，需要協調資料欄位改名時程。

---

## 下週項目（建議）
- **Web / Infra**：與後端協作補齊 HTTP 安全標頭、Cache-Control 與 CSP 設定，並把檢查納入 CI。
- **Web / 前端**：依 Edge 報告優先級優化表單語意與 CSS 動畫，安排跨裝置手動測試 `/predict`、`/livescore` 的節流與快取行為。
- **API**：為 `PredictionStats`、`forum-stats` 建立快取指標（命中率、平均延遲），並規劃快取失效策略。
- **SEO**：啟動 Nuxt3 首頁 + Vite 應用的混合架構 PoC，評估流量與內容資源需求。

---

**本週整體評估：功能開發與法遵需求皆如期完成，主要風險集中在 HTTP Header 與外部資源依賴，已列入下週優先任務。**

